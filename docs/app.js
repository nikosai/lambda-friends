!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=7)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(t,e){void 0===e?(this.name="LambdaFriendsError",this.message=t):(this.name=t,this.message=e)}toString(){return this.name+": "+this.message}}e.LambdaFriendsError=r;e.LambdaParseError=class extends r{constructor(t){super("LambdaParseError",t)}};e.SubstitutionError=class extends r{constructor(t){super("SubstitutionError",t)}};e.ReductionError=class extends r{constructor(t){super("ReductionError",t)}};e.MacroError=class extends r{constructor(t){super("MacroError",t)}};e.TypeError=class extends r{constructor(t){super("TypeError",t)}};e.TexError=class extends r{constructor(t){super("TexError",t)}};e.GraphParseError=class extends r{constructor(t){super("GraphParseError",t)}};e.TranslateError=class extends r{constructor(t){super("TranslateError",t)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(4),i=n(0),s=n(3),a=n(5),o=n(2),l=n(6);class h{constructor(t,e){this.eqs=t,this.proofTree=e}}class u{constructor(t){this.className=t}parseChurchNum(){if(!(this instanceof w))return null;const t=this.boundvar;let e=this.expr,n=0;if(!(e instanceof w))return null;const r=e.boundvar;if(t.equals(r))return null;for(e=e.expr;e instanceof y;){if(n++,!e.left.equals(t))return null;e=e.right}return e.equals(r)?n:null}parseChurchBool(){const t=new w(new d("x"),new w(new d("y"),new d("x"))),e=new w(new d("x"),new w(new d("y"),new d("y")));return!!this.equalsAlpha(t)||!this.equalsAlpha(e)&&null}toLMNtal(){throw new i.TypeError("Expression '"+this+"' cannot be converted into LMNtal (untyped only).")}toSKI(){throw new i.TypeError("Expression '"+this+"' cannot be converted to SKI combinators (untyped only).")}getDeBrujin(t){throw new i.TypeError("Expression '"+this+"' cannot be converted to de Brujin indexes (untyped only).")}toDeBrujin(){return this.getDeBrujin([])}}e.Expression=u;class c extends u{constructor(t,e){super(void 0===e?"Symbol":e),this.name=t}equals(t){return t instanceof c&&t.className===this.className&&t.name===this.name}equalsAlpha(t){return t instanceof c&&t.className===this.className&&t.name===this.name}toString(t){return this.name}toTexString(t){throw new i.TexError("class Symbol does not have tex string")}getFV(){return this.freevars}substitute(t,e){throw new i.SubstitutionError("Undefined Substitution")}getEquations(t,e,n){throw new i.TypeError("Undefined Type")}getRedexes(t,e,n){throw new i.ReductionError("Symbols must not appear in parsed Expression")}getLeftMostRedex(t,e,n){throw new i.ReductionError("Symbols must not appear in parsed Expression")}extractMacros(){throw new i.ReductionError("Symbols must not appear in parsed Expression")}}e.Symbol=c;class d extends c{constructor(t){super(t,"Variable"),this.freevars=[this]}substitute(t,e){return this.equals(t)?e:this}getEquations(t,e,n){for(let n of t)if(n.equals(this)){let i="\\AxiomC{}\n";return i+="\\RightLabel{\\scriptsize(var)}\n",i+="\\UnaryInfC{$"+d.gammaToTexString(t)+" \\vdash "+this.name+" : "+e.toTexString()+" $}\n",new h([new r.TypeEquation(n.type,e)],i)}throw new i.TypeError("free variable is not allowed: "+this)}toTexString(t){return this.name}static union(t,e,n){if(void 0===n){let n=[];for(let e of t)n.push(e);for(let r of d.dif(e,t))n.push(r);return n}return d.union(d.union(t,e),n)}static dif(t,e){let n=[];for(let r of t)d.contains(e,r)||n.push(r);return n}static contains(t,e){for(let n of t)if(n.equals(e))return!0;return!1}static gammaToTexString(t){if(0===t.length)return"";let e=t[0].name+" : "+t[0].type.toTexString();for(let n=1;n<t.length;n++)e+=",~"+t[n].name+" : "+t[n].type.toTexString();return e}static getNew(t){let e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");for(let n of e){let e=new d(n);if(!d.contains(t,e))return e}throw new i.SubstitutionError("No more Variables available")}getRedexes(t,e,n){return[]}getLeftMostRedex(t,e,n){return null}extractMacros(){return this}toLMNtal(){return"fv("+this.name+")"}toSKI(){return this}getDeBrujin(t){for(let e=0;e<t.length;e++)if(t[e].equals(this))return new l.deBrujinIndex(e);return new l.deBrujinFreeVar(this.name)}}e.Variable=d;class f extends c{constructor(t,e){super(t,e),this.freevars=[]}substitute(t,e){return this}getEquations(t,e,n){let i="\\AxiomC{}\n";return i+="\\RightLabel{\\scriptsize(con)}\n",i+="\\UnaryInfC{$"+d.gammaToTexString(t)+" \\vdash "+this.toTexString(n)+" : "+e.toTexString()+" $}\n",new h([new r.TypeEquation(this.type,e)],i)}toString(t){return"["+this.name+"]"}toTexString(t){return this.name+"^{"+this.type.toTexString()+"}"}getRedexes(t,e,n){if(t)return[];throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className)}getLeftMostRedex(t,e,n){if(t)return null;throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className)}extractMacros(){return this}}e.Const=f;class p extends f{constructor(t){super(t.toString(),"ConstInt"),this.value=t,this.type=new r.TypeInt}}e.ConstInt=p;class g extends f{constructor(t){super(t.toString(),"ConstBool"),this.value=t,this.type=new r.TypeBool}}e.ConstBool=g;class m extends f{constructor(t){switch(super(t,"ConstOp"),t){case"+":this.value=((t,e)=>new p(t.value+e.value)),this.type=new r.TypeFunc(new r.TypeInt,new r.TypeFunc(new r.TypeInt,new r.TypeInt));break;case"-":this.value=((t,e)=>new p(t.value-e.value)),this.type=new r.TypeFunc(new r.TypeInt,new r.TypeFunc(new r.TypeInt,new r.TypeInt));break;case"*":this.value=((t,e)=>new p(t.value*e.value)),this.type=new r.TypeFunc(new r.TypeInt,new r.TypeFunc(new r.TypeInt,new r.TypeInt));break;case"/":this.value=((t,e)=>{if(0===e.value)throw new i.ReductionError("Dividing by '0' is not allowed");return new p(Math.floor(t.value/e.value))}),this.type=new r.TypeFunc(new r.TypeInt,new r.TypeFunc(new r.TypeInt,new r.TypeInt));break;case"%":this.value=((t,e)=>{if(0===e.value)throw new i.ReductionError("Dividing by '0' is not allowed");return new p(t.value-4*Math.floor(t.value/e.value))}),this.type=new r.TypeFunc(new r.TypeInt,new r.TypeFunc(new r.TypeInt,new r.TypeInt));break;case"<":this.value=((t,e)=>new g(t.value<e.value)),this.type=new r.TypeFunc(new r.TypeInt,new r.TypeFunc(new r.TypeInt,new r.TypeBool));break;case">":this.value=((t,e)=>new g(t.value>e.value)),this.type=new r.TypeFunc(new r.TypeInt,new r.TypeFunc(new r.TypeInt,new r.TypeBool));break;case"<=":this.value=((t,e)=>new g(t.value<=e.value)),this.type=new r.TypeFunc(new r.TypeInt,new r.TypeFunc(new r.TypeInt,new r.TypeBool));break;case">=":this.value=((t,e)=>new g(t.value>=e.value)),this.type=new r.TypeFunc(new r.TypeInt,new r.TypeFunc(new r.TypeInt,new r.TypeBool));break;case"==":case"=":this.value=((t,e)=>new g(t.value==e.value)),this.type=new r.TypeFunc(new r.TypeInt,new r.TypeFunc(new r.TypeInt,new r.TypeBool));break;case"!=":this.value=((t,e)=>new g(t.value!=e.value)),this.type=new r.TypeFunc(new r.TypeInt,new r.TypeFunc(new r.TypeInt,new r.TypeBool));break;case"eq":this.value=((t,e)=>new g(t.value==e.value)),this.type=new r.TypeFunc(new r.TypeBool,new r.TypeFunc(new r.TypeBool,new r.TypeBool));break;case"xor":this.value=((t,e)=>new g(t.value!=e.value)),this.type=new r.TypeFunc(new r.TypeBool,new r.TypeFunc(new r.TypeBool,new r.TypeBool));break;case"or":this.value=((t,e)=>new g(t.value||e.value)),this.type=new r.TypeFunc(new r.TypeBool,new r.TypeFunc(new r.TypeBool,new r.TypeBool));break;case"and":this.value=((t,e)=>new g(t.value&&e.value)),this.type=new r.TypeFunc(new r.TypeBool,new r.TypeFunc(new r.TypeBool,new r.TypeBool));break;case"nor":this.value=((t,e)=>new g(!(t.value||e.value))),this.type=new r.TypeFunc(new r.TypeBool,new r.TypeFunc(new r.TypeBool,new r.TypeBool));break;case"nand":this.value=((t,e)=>new g(!(t.value&&e.value))),this.type=new r.TypeFunc(new r.TypeBool,new r.TypeFunc(new r.TypeBool,new r.TypeBool));break;default:throw new i.LambdaParseError("Undefined function: "+t)}}}e.ConstOp=m;class x extends c{substitute(t,e){return this}constructor(){super("nil","Nil"),this.freevars=[]}getEquations(t,e,n){let i=r.TypeVariable.getNew(),s=new r.TypeList(i),a="\\AxiomC{}\n";return a+="\\RightLabel{\\scriptsize(nil)}\n",a+="\\UnaryInfC{$"+d.gammaToTexString(t)+" \\vdash "+this.name+" : "+s.toTexString()+" $}\n",new h([new r.TypeEquation(e,s)],a)}toString(t){return"["+this.name+"]"}toTexString(t){return"{\\rm "+this.name+"}"}getRedexes(t,e,n){if(t)return[];throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className)}getLeftMostRedex(t,e,n){if(t)return null;throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className)}extractMacros(){return this}}e.Nil=x;class b extends c{constructor(t,e,n,r){super(t,"Macro"),this.freevars=[],this.expr=e,this.typed=n,this.type=r}static add(t,e,n){let r=e.expr;if(!/^[a-zA-Z0-9!?]+$/.test(t))throw new i.MacroError("<"+t+"> cannot be used as a name of macro. Available characters: [a-zA-Z0-9!?]");let s=n?b.map:b.mapUntyped;if(0!==r.getFV().length)throw new i.MacroError("<"+t+"> contains free variables: "+r.getFV());let a=new b(t,r,n,e.type);return s[t]=a,s[t]}static clear(t){t?b.map={}:b.mapUntyped={}}static get(t,e){let n;if(void 0===(n=e?b.map[t]:b.mapUntyped[t])){let n=n=>new b(t,o.makeAST(n,e),e,void 0);return null!==t.match(/^\d+$/)?n(o.makeChurchNum(parseInt(t))):"true"===t?n("\\xy.x"):"false"===t?n("\\xy.y"):"S"===t?n("\\fgx.fx(gx)"):"K"===t?n("\\xy.x"):"I"===t?n("\\x.x"):new b(t,void 0,e,void 0)}return new b(t,n.expr,e,n.type)}static getMap(t){return Object.assign({},t?b.map:b.mapUntyped)}substitute(t,e){return this}toString(t){return"<"+this.name+">"}equalsAlpha(t){return void 0===this.expr?this.equals(t):this.expr.equalsAlpha(t)}getEquations(t,e,n){if(void 0===this.expr)throw new i.TypeError(this+" is undefined.");return this.expr.getEquations(t,e,n)}toTexString(t){return"\\,\\overline{\\bf "+this.name+"}\\,"}getRedexes(t,e,n){let r=b.get(this.name,t);return void 0===r.expr?[]:[new a.MacroRedex(r)]}getLeftMostRedex(t,e,n){let r=b.get(this.name,t);return void 0===r.expr?null:new a.MacroRedex(r)}extractMacros(){return void 0===this.expr?this:this.expr.extractMacros()}toLMNtal(){return void 0===this.expr?"fv("+this.name+")":this.expr.toLMNtal()}toSKI(){return this}getDeBrujin(t){return void 0===this.expr?new l.deBrujinFreeVar(this.name):this.expr.getDeBrujin(t)}}b.map={},b.mapUntyped={},e.Macro=b;class w extends u{constructor(t,e){super("LambdaAbstraction"),this.freevars=void 0,this.boundvar=t,this.expr=e}static parse(t,e){let n=[];for(;t.length>0;){let r=t.shift();if("."===r.name){if(0===n.length)throw new i.LambdaParseError("Bound variables are expected.");let r=o.parseSymbols(t,e);for(;n.length>0;)r=new w(n.pop(),r);return r}if(null===r.name.match(/^[A-Za-z]$/))throw new i.LambdaParseError("Unexpected token: '"+r+"'");n.push(new d(r.name))}throw new i.LambdaParseError("'.' is needed")}toString(t){let e=[this.boundvar],n=this.expr;for(;n instanceof w;)e.push(n.boundvar),n=n.expr;let r="\\"+e.join("")+"."+n.toString(!0);return t||(r="("+r+")"),r}getFV(){return void 0!==this.freevars?this.freevars:(this.freevars=[],this.freevars=d.dif(this.expr.getFV(),[this.boundvar]))}substitute(t,e){if(this.boundvar.equals(t))return this;if(d.contains(e.getFV(),this.boundvar)){let n=d.union(this.expr.getFV(),e.getFV()),r=d.getNew(n);return new w(r,this.expr.substitute(this.boundvar,r)).substitute(t,e)}return new w(this.boundvar,this.expr.substitute(t,e))}equals(t){return t instanceof w&&t.boundvar.equals(this.boundvar)&&t.expr.equals(this.expr)}equalsAlpha(t){if(!(t instanceof w))return!1;if(this.equals(t))return!0;let e=this.boundvar,n=this.expr,r=t.boundvar,i=t.expr,s=d.getNew(d.union(n.getFV(),i.getFV()));return n.substitute(e,s).equalsAlpha(i.substitute(r,s))}getEquations(t,e,n){let i=r.TypeVariable.getNew(),s=r.TypeVariable.getNew();this.boundvar.type=s;let a=this.expr.getEquations(t.concat(this.boundvar),i,!0),o=a.proofTree;return o+="\\RightLabel{\\scriptsize(abs)}\n",o+="\\UnaryInfC{$"+d.gammaToTexString(t)+" \\vdash "+this.toTexString(n)+" : "+e.toTexString()+" $}\n",new h(a.eqs.concat(new r.TypeEquation(e,new r.TypeFunc(s,i))),o)}toTexString(t){let e=[this.boundvar.toTexString(!1)],n=this.expr;for(;n instanceof w;)e.push(n.boundvar.toTexString(!1)),n=n.expr;let r="\\lambda "+e.join("")+"."+n.toTexString(!0);return t||(r="("+r+")"),r}isEtaRedex(){return this.expr instanceof y&&this.expr.right.equals(this.boundvar)&&!d.contains(this.expr.left.getFV(),this.boundvar)}getRedexes(t,e,n){if(t)return[];let r=[this.boundvar],i=this.expr;for(;i instanceof w;)r.push(i.boundvar),i=i.expr;let s="",o="";n||(s="(",o=")");let l=a.Redex.makeNext(i.getRedexes(!1,e,!0),s+"\\"+r.join("")+".",o,s+"\\lambda{"+r.join("")+"}.",o,t=>{let e=[].concat(r),n=t;for(;e.length>0;){let t=e.pop();n=new w(t,n)}return n});return void 0===e&&(console.error("etaAllowed is undefined."),e=!1),e&&this.isEtaRedex()&&l.push(new a.EtaRedex(this)),l}getLeftMostRedex(t,e,n){if(t)return null;if(void 0===e&&(console.error("etaAllowed is undefined."),e=!1),e&&this.isEtaRedex())return new a.EtaRedex(this);let r=[this.boundvar],i=this.expr;for(;i instanceof w;)r.push(i.boundvar),i=i.expr;let s="",o="";n||(s="(",o=")");let l=i.getLeftMostRedex(!1,e,!0);return null===l?null:(l.next=(t=>{let e=[].concat(r),n=t;for(;e.length>0;){let t=e.pop();n=new w(t,n)}return n})(l.next),l.addLeft(s+"\\"+r.join("")+"."),l.addRight(o),l.addTexLeft(s+"\\lambda{"+r.join("")+"}."),l.addTexRight(o),l)}extractMacros(){return new w(this.boundvar,this.expr.extractMacros())}toLMNtal(){let t=this.expr.toLMNtal().split("fv("+this.boundvar.name+")"),e=t[0],n=[];for(let r=1;r<t.length;r++){let i=s.LambdaFriends.getNewLink();n.push(i),e+=i+t[r]}return"lambda("+function t(e){switch(e.length){case 0:return"rm";case 1:return e[0];case 2:return"cp("+e[0]+","+e[1]+")";default:return"cp("+e.shift()+","+t(e)+")"}}(n)+","+e+")"}toSKI(){if(!d.contains(this.expr.getFV(),this.boundvar))return new y(b.get("K",!1),this.expr.toSKI());if(this.boundvar.equals(this.expr))return b.get("I",!1);if(this.expr instanceof y){let t=t=>new w(this.boundvar,t).toSKI();return new y(new y(b.get("S",!1),t(this.expr.left)),t(this.expr.right))}if(this.expr instanceof w){let t=this.expr.toSKI();return new w(this.boundvar,t).toSKI()}throw new i.TranslateError("Unknown kind of expression.")}getDeBrujin(t){t.unshift(this.boundvar);let e=this.expr.getDeBrujin(t);return t.shift(),new l.deBrujinLambda(e)}}e.LambdaAbstraction=w;class y extends u{constructor(t,e){super("Application"),this.left=t,this.right=e}isBetaRedex(){return this.left instanceof w}toString(t){let e=this.left.toString(this.left instanceof y)+this.right.toString(!1);return t||(e="("+e+")"),e}getFV(){return void 0===this.freevars?this.freevars=d.union(this.left.getFV(),this.right.getFV()):this.freevars}substitute(t,e){return new y(this.left.substitute(t,e),this.right.substitute(t,e))}equals(t){return t instanceof y&&t.left.equals(this.left)&&t.right.equals(this.right)}equalsAlpha(t){return t instanceof y&&t.left.equalsAlpha(this.left)&&t.right.equalsAlpha(this.right)}getEquations(t,e,n){let i=r.TypeVariable.getNew(),s=this.left.getEquations(t,new r.TypeFunc(i,e),!1),a=this.right.getEquations(t,i,!1),o=s.proofTree+a.proofTree;return o+="\\RightLabel{\\scriptsize(app)}\n",o+="\\BinaryInfC{$"+d.gammaToTexString(t)+" \\vdash "+this.toTexString(n)+" : "+e.toTexString()+" $}\n",new h(s.eqs.concat(a.eqs),o)}toTexString(t){let e=this.left.toTexString(this.left instanceof y)+this.right.toTexString(!1);return t||(e="("+e+")"),e}getRedexes(t,e,n){if(t){let t=n?"":"(",e=n?"":")";if(this.left instanceof w)return[new a.TypedRedex(this,this.left.expr.substitute(this.left.boundvar,this.right),"app2")];if(this.left instanceof y&&this.left.left instanceof m&&this.left.right instanceof f){let n=this.left.left,s=this.left.right,o=this.right;if(o instanceof f){if(n.type.left.equals(s.type)&&n.type.right instanceof r.TypeFunc&&n.type.right.left.equals(o.type))return[new a.TypedRedex(this,n.value(s,o),"app5")];throw new i.ReductionError(n.type+" cannot handle "+s.type+" and "+o.type+" as arguments")}return a.Redex.makeNext(o.getRedexes(!0,!1,!1),t+n.toString(!1)+s.toString(!1),e,t+n.toTexString(!1)+s.toTexString(!1),e,t=>new y(new y(n,s),t))}return this.left instanceof m?a.Redex.makeNext(this.right.getRedexes(!0,!1,!1),t+this.left.toString(!1),e,t+this.left.toTexString(!1),e,t=>new y(this.left,t)):a.Redex.makeNext(this.left.getRedexes(!0,!1,!1),t,e+this.right.toString(!1),t,e+this.right.toTexString(!1),t=>new y(t,this.right))}{let t=[this],r=[""],i=[""];for(;;){let e=t[t.length-1];if(r.push(e.right.toString(!1)+r[r.length-1]),i.push(e.right.toTexString(!1)+r[i.length-1]),!(e.left instanceof y))break;t.push(e.left)}let s=t[t.length-1].left.getRedexes(!1,e,!1);for(;t.length>0;){let n=t.pop(),o=a.Redex.makeNext(s,"",n.right.toString(!1),"",n.right.toTexString(!1),t=>new y(t,n.right)),l=n.left.toString(n.left instanceof y),h=a.Redex.makeNext(n.right.getRedexes(!1,e,!1),l,"",n.left.toTexString(!1),"",t=>new y(n.left,t));s=o.concat(h),r.pop(),i.pop(),n.isBetaRedex()&&s.push(new a.BetaRedex(n))}return n||(s=a.Redex.makeNext(s,"(",")","(",")",t=>t)),s}}getLeftMostRedex(t,e,n){if(t){let t=n?"":"(",e=n?"":")";if(this.left instanceof w)return new a.TypedRedex(this,this.left.expr.substitute(this.left.boundvar,this.right),"app2");if(this.left instanceof y&&this.left.left instanceof m&&this.left.right instanceof f){let n=this.left.left,s=this.left.right,o=this.right;if(o instanceof f){if(n.type.left.equals(s.type)&&n.type.right instanceof r.TypeFunc&&n.type.right.left.equals(o.type))return new a.TypedRedex(this,n.value(s,o),"app5");throw new i.ReductionError(n.type+" cannot handle "+s.type+" and "+o.type+" as arguments")}{let r=o.getLeftMostRedex(!0,!1,!1);return null===r?null:(r.next=new y(new y(n,s),r.next),r.addLeft(t+n.toString(!1)+s.toString(!1)),r.addRight(e),r.addTexLeft(t+n.toTexString(!1)+s.toTexString(!1)),r.addTexRight(e),r)}}if(this.left instanceof m){let n=this.right.getLeftMostRedex(!0,!1,!1);return null===n?null:(n.next=new y(this.left,n.next),n.addLeft(t+this.left.toString(!1)),n.addRight(e),n.addTexLeft(t+this.left.toTexString(!1)),n.addTexRight(e),n)}{let n=this.right.getLeftMostRedex(!0,!1,!1);return null===n?null:(n.next=new y(this.left,n.next),n.addLeft(t),n.addRight(e+this.right.toString(!1)),n.addTexLeft(t),n.addTexRight(e+this.right.toTexString(!1)),n)}}{let t=[this],r=[""],i=[""];for(;;){let e=t[t.length-1];if(r.push(e.right.toString(!1)+r[r.length-1]),i.push(e.right.toTexString(!1)+r[i.length-1]),!(e.left instanceof y))break;t.push(e.left)}let s=t[t.length-1].left.getLeftMostRedex(!1,e,!1);for(;t.length>0;){let n=t.pop();if(n.isBetaRedex())s=new a.BetaRedex(n);else if(null===s){if(null!==(s=n.right.getLeftMostRedex(!1,e,!1))){let t=n.left.toString(!0);s.next=new y(n.left,s.next),s.addLeft(t),s.addRight(""),s.addTexLeft(n.left.toTexString(!1)),s.addTexRight("")}}else s.next=new y(s.next,n.right),s.addLeft(""),s.addRight(n.right.toString(!1)),s.addTexLeft(""),s.addTexRight(n.right.toTexString(!1));r.pop(),i.pop()}return null===s?null:(n||(s.addLeft("("),s.addRight(")"),s.addTexLeft("("),s.addTexRight(")")),s)}}extractMacros(){return new y(this.left.extractMacros(),this.right.extractMacros())}toLMNtal(){return"apply("+this.left.toLMNtal()+","+this.right.toLMNtal()+")"}toSKI(){return new y(this.left.toSKI(),this.right.toSKI())}getDeBrujin(t){return new l.deBrujinApplication(this.left.getDeBrujin(t),this.right.getDeBrujin(t))}}e.Application=y;class T extends u{constructor(t,e){super("List"),this.head=t,this.tail=e}toString(t){let e=this.head.toString(!1)+"::"+this.tail.toString(!0);return t||(e="("+e+")"),e}getFV(){return void 0===this.freevars?this.freevars=d.union(this.head.getFV(),this.tail.getFV()):this.freevars}substitute(t,e){return new T(this.head.substitute(t,e),this.tail.substitute(t,e))}equals(t){return t instanceof T&&t.head.equals(this.head)&&t.tail.equals(this.tail)}equalsAlpha(t){return t instanceof T&&t.head.equalsAlpha(this.head)&&t.tail.equalsAlpha(this.tail)}getEquations(t,e,n){let i=r.TypeVariable.getNew(),s=new r.TypeList(i),a=this.head.getEquations(t,i,!1),o=this.tail.getEquations(t,s,!1),l=a.proofTree+o.proofTree;return l+="\\RightLabel{\\scriptsize(list)}\n",l+="\\BinaryInfC{$"+d.gammaToTexString(t)+" \\vdash "+this.toTexString(n)+" : "+s.toTexString()+" $}\n",new h(a.eqs.concat(o.eqs,new r.TypeEquation(s,e)),l)}toTexString(t){let e=this.head.toTexString(!1)+"::"+this.tail.toTexString(!0);return t||(e="("+e+")"),e}getRedexes(t,e,n){if(t)return[];throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className)}getLeftMostRedex(t,e,n){if(t)return null;throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className)}extractMacros(){return new T(this.head.extractMacros(),this.tail.extractMacros())}}e.List=T;class v extends u{constructor(t,e,n){super("If"),this.state=t,this.ifTrue=e,this.ifFalse=n}getFV(){return this.freevars=d.union(this.state.getFV(),this.ifTrue.getFV(),this.ifFalse.getFV())}toString(t){let e="[if]"+this.state.toString(!0)+"[then]"+this.ifTrue.toString(!0)+"[else]"+this.ifFalse.toString(!0);return t||(e="("+e+")"),e}substitute(t,e){return new v(this.state.substitute(t,e),this.ifTrue.substitute(t,e),this.ifFalse.substitute(t,e))}equals(t){return t instanceof v&&t.state.equals(this.state)&&t.ifTrue.equals(this.ifTrue)&&t.ifFalse.equals(this.ifFalse)}equalsAlpha(t){return t instanceof v&&t.state.equalsAlpha(this.state)&&t.ifTrue.equalsAlpha(this.ifTrue)&&t.ifFalse.equalsAlpha(this.ifFalse)}getEquations(t,e,n){let i=this.state.getEquations(t,new r.TypeBool,!0),s=this.ifTrue.getEquations(t,e,!0),a=this.ifFalse.getEquations(t,e,!0),o=i.proofTree+s.proofTree+a.proofTree;return o+="\\RightLabel{\\scriptsize(if)}\n",o+="\\TrinaryInfC{$"+d.gammaToTexString(t)+" \\vdash "+this.toTexString(n)+" : "+e.toTexString()+" $}\n",new h(i.eqs.concat(s.eqs,a.eqs),o)}toTexString(t){let e="{\\bf if}~"+this.state.toTexString(!0)+"~{\\bf then}~"+this.ifTrue.toTexString(!0)+"~{\\bf else}~"+this.ifFalse.toTexString(!0);return t||(e="("+e+")"),e}getRedexes(t,e,n){if(!t)throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className);return this.state instanceof g?this.state.value?[new a.TypedRedex(this,this.ifTrue,"if2")]:[new a.TypedRedex(this,this.ifFalse,"if3")]:a.Redex.makeNext(this.state.getRedexes(!0,!1,!1),"([if]","[then]"+this.ifTrue.toString(!0)+"[else]"+this.ifFalse.toString(!0)+")","({\\bf if}~","~{\\bf then}~"+this.ifTrue.toTexString(!0)+"~{\\bf else}~"+this.ifFalse.toTexString(!0)+")",t=>new v(t,this.ifTrue,this.ifFalse))}getLeftMostRedex(t,e,n){if(!t)throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className);if(this.state instanceof g)return this.state.value?new a.TypedRedex(this,this.ifTrue,"if2"):new a.TypedRedex(this,this.ifFalse,"if3");{let t=this.state.getLeftMostRedex(!0,!1,!1);return null===t?null:(t.next=new v(t.next,this.ifTrue,this.ifFalse),t.addLeft("([if]"),t.addRight("[then]"+this.ifTrue.toString(!0)+"[else]"+this.ifFalse.toString(!0)+")"),t.addTexLeft("({\\bf if}~"),t.addTexRight("~{\\bf then}~"+this.ifTrue.toTexString(!0)+"~{\\bf else}~"+this.ifFalse.toTexString(!0)+")"),t)}}static parse(t,e){let n=[],r=0,s=0,a=0;for(;;){if(0==t.length)throw new i.LambdaParseError("Illegal If statement");let e=t.shift();switch(e.name){case"if":r++;break;case"then":s++;break;case"else":a++}if(r===a&&s===r+1)break;n.push(e)}let l=o.parseSymbols(n,e),h=[];for(r=0,s=0,a=0;;){if(0==t.length)throw new i.LambdaParseError("Illegal If statement");let e=t.shift();switch(e.name){case"if":r++;break;case"then":s++;break;case"else":a++}if(r===s&&a===r+1)break;h.push(e)}let u=o.parseSymbols(h,e),c=o.parseSymbols(t,e);return new v(l,u,c)}extractMacros(){return new v(this.state.extractMacros(),this.ifTrue.extractMacros(),this.ifFalse.extractMacros())}}e.If=v;class S extends u{constructor(t,e,n){super("Let"),this.boundvar=t,this.left=e,this.right=n}getFV(){if(void 0!==this.freevars)return this.freevars;let t=[];for(let e of this.right.getFV())e.equals(this.boundvar)||t.push(e);return this.freevars=d.union(t,this.left.getFV())}toString(t){let e="[let]"+this.boundvar.toString(!0)+"="+this.left.toString(!0)+"[in]"+this.right.toString(!0);return t||(e="("+e+")"),e}substitute(t,e){let n=this.left.substitute(t,e);if(this.boundvar.equals(t))return new S(this.boundvar,n,this.right);if(d.contains(e.getFV(),this.boundvar)){let r=d.union(this.right.getFV(),e.getFV()),i=d.getNew(r);return i.equals(t)?new S(i,n,this.right.substitute(this.boundvar,i)):new S(i,n,this.right.substitute(this.boundvar,i).substitute(t,e))}return new S(this.boundvar,n,this.right.substitute(t,e))}equals(t){return t instanceof S&&t.boundvar.equals(this.boundvar)&&t.left.equals(this.left)&&t.right.equals(this.right)}equalsAlpha(t){if(!(t instanceof S))return!1;if(this.equals(t))return!0;let e=this.boundvar,n=this.right,r=t.boundvar,i=t.right;return!d.contains(n.getFV(),r)&&i.equalsAlpha(n.substitute(e,r))}getEquations(t,e,n){let i=r.TypeVariable.getNew();this.boundvar.type=i;let s=this.left.getEquations(t,i,!0),a=this.right.getEquations(t.concat(this.boundvar),e,!0),o=s.proofTree+a.proofTree;return o+="\\RightLabel{\\scriptsize(let)}\n",o+="\\TrinaryInfC{$"+d.gammaToTexString(t)+" \\vdash "+this.toTexString(n)+" : "+e.toTexString()+" $}\n",new h(s.eqs.concat(a.eqs),o)}toTexString(t){let e="{\\bf let}~"+this.boundvar.toTexString(!1)+" = "+this.left.toTexString(!0)+"~{\\bf in}~"+this.right.toTexString(!0);return t||(e="("+e+")"),e}getRedexes(t,e,n){if(!t)throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className);return[new a.TypedRedex(this,this.right.substitute(this.boundvar,this.left),"let")]}getLeftMostRedex(t,e,n){if(!t)throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className);return new a.TypedRedex(this,this.right.substitute(this.boundvar,this.left),"let")}static parse(t,e){let n=t.shift();if(null===n.name.match(/^[A-Za-z]$/))throw new i.LambdaParseError("Unexpected token: '"+n+"'");let r=new d(n.name);if("="!==t.shift().name)throw new i.LambdaParseError("'=' is expected");let s=[],a=1;for(;;){if(0==t.length)throw new i.LambdaParseError("Illegal Let statement");let e=t.shift();if("let"===e.name?a++:"in"===e.name&&a--,0==a)break;s.push(e)}let l=o.parseSymbols(s,e),h=o.parseSymbols(t,e);return new S(r,l,h)}extractMacros(){return new S(this.boundvar,this.left.extractMacros(),this.right.extractMacros())}}e.Let=S;class E extends u{constructor(t,e,n,r,i){super("Case"),this.state=t,this.ifNil=e,this.head=n,this.tail=r,this.ifElse=i}getFV(){return void 0!==this.freevars?this.freevars:d.union(this.state.getFV(),this.ifNil.getFV(),d.dif(this.ifElse.getFV(),[this.head,this.tail]))}toString(t){let e="[case]"+this.state.toString(!0)+"[of][nil]->"+this.ifNil.toString(!0)+"|"+this.head.toString(!0)+"::"+this.tail.toString(!0)+"->"+this.ifElse.toString(!0);return t||(e="("+e+")"),e}substitute(t,e){let n=this.state.substitute(t,e),r=this.ifNil.substitute(t,e);if(this.head.equals(t)||this.tail.equals(t))return new E(n,r,this.head,this.tail,this.ifElse);if(d.contains(e.getFV(),this.head)||d.contains(e.getFV(),this.tail)){let i=this.head,s=this.tail,a=this.ifElse;if(d.contains(e.getFV(),i)){let n=d.union(this.ifElse.getFV(),e.getFV()),r=d.getNew(n);a=r.equals(t)?a.substitute(i,r):a.substitute(i,r).substitute(t,e),i=r}if(d.contains(e.getFV(),s)){let n=d.union(this.ifElse.getFV(),e.getFV()),r=d.getNew(n);a=r.equals(t)?a.substitute(s,r):a.substitute(s,r).substitute(t,e),s=r}return new E(n,r,i,s,a)}return new E(n,r,this.head,this.tail,this.ifElse.substitute(t,e))}equals(t){return t instanceof E&&t.state.equals(this.state)&&t.ifNil.equals(this.ifNil)&&t.head.equals(this.head)&&t.tail.equals(this.tail)&&t.ifElse.equals(this.ifElse)}equalsAlpha(t){return t instanceof E&&t.state.equalsAlpha(this.state)&&t.ifNil.equalsAlpha(this.ifNil)&&t.head.equalsAlpha(this.head)&&t.tail.equalsAlpha(this.tail)&&t.ifElse.equalsAlpha(this.ifElse)}getEquations(t,e,n){let i=r.TypeVariable.getNew(),s=new r.TypeList(i);this.head.type=i,this.tail.type=s;let a=this.state.getEquations(t,s,!0),o=this.ifNil.getEquations(t,e,!0),l=this.ifElse.getEquations(t.concat(this.head,this.tail),e,!0),u=a.proofTree+o.proofTree+l.proofTree;return u+="\\RightLabel{\\scriptsize(case)}\n",u+="\\TrinaryInfC{$"+d.gammaToTexString(t)+" \\vdash "+this.toTexString(n)+" : "+e.toTexString()+" $}\n",new h(a.eqs.concat(o.eqs,l.eqs),u)}toTexString(t){let e="{\\bf case} "+this.state.toTexString(!0)+" {\\bf of} {\\rm nil} \\Rightarrow "+this.ifNil.toTexString(!0)+" | "+this.head.toTexString(!0)+"::"+this.tail.toTexString(!0)+" \\Rightarrow "+this.ifElse.toTexString(!0);return t||(e="("+e+")"),e}getRedexes(t,e){if(!t)throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className);return this.state instanceof x?[new a.TypedRedex(this,this.ifNil,"case2")]:this.state instanceof T?[new a.TypedRedex(this,this.ifElse.substitute(this.head,this.state.head).substitute(this.tail,this.state.tail),"case3")]:a.Redex.makeNext(this.state.getRedexes(!0,!1,!0),"([case]","[of][nil]->"+this.ifNil+" | "+this.head+"::"+this.tail+"->"+this.ifElse+")","({\\bf case} "," {\\bf of} {\\rm nil} \\Rightarrow "+this.ifNil.toTexString(!0)+" | "+this.head.toTexString(!0)+"::"+this.tail.toTexString(!0)+" \\Rightarrow "+this.ifElse.toTexString(!0)+")",t=>new E(t,this.ifNil,this.head,this.tail,this.ifElse))}getLeftMostRedex(t,e){if(!t)throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className);if(this.state instanceof x)return new a.TypedRedex(this,this.ifNil,"case2");if(this.state instanceof T)return new a.TypedRedex(this,this.ifElse.substitute(this.head,this.state.head).substitute(this.tail,this.state.tail),"case3");{let t=this.state.getLeftMostRedex(!0,!1,!0);return null===t?null:(t.next=new E(t.next,this.ifNil,this.head,this.tail,this.ifElse),t.addLeft("([case]"),t.addRight("[of][nil]->"+this.ifNil+" | "+this.head+"::"+this.tail+"->"+this.ifElse+")"),t.addTexLeft("({\\bf case} "),t.addTexRight(" {\\bf of} {\\rm nil} \\Rightarrow "+this.ifNil.toTexString(!0)+" | "+this.head.toTexString(!0)+"::"+this.tail.toTexString(!0)+" \\Rightarrow "+this.ifElse.toTexString(!0)+")"),t)}}static parse(t,e){let n=[],r=1;for(;;){if(0==t.length)throw new i.LambdaParseError("Illegal Case statement");let e=t.shift();if("case"===e.name?r++:"of"===e.name&&r--,0==r)break;n.push(e)}let s=o.parseSymbols(n,e),a=t.shift();if("nil"!==a.name)throw new i.LambdaParseError("Unexpected token: '"+a+"'");if("-"!==(a=t.shift()).name)throw new i.LambdaParseError("Unexpected token: '"+a+"'");if(">"!==(a=t.shift()).name)throw new i.LambdaParseError("Unexpected token: '"+a+"'");let l=[];for(r=1;;){if(0==t.length)throw new i.LambdaParseError("Too many [case]");let e=t.shift();if("case"===e.name?r++:"|"===e.name&&r--,0==r)break;l.push(e)}let h=o.parseSymbols(l,e),u=new d(t.shift().name);if(null===u.name.match(/^[A-Za-z]$/))throw new i.LambdaParseError("Unexpected token: '"+u.name+"'");if(":"!==(a=t.shift()).name)throw new i.LambdaParseError("Unexpected token: '"+a+"'");if(":"!==(a=t.shift()).name)throw new i.LambdaParseError("Unexpected token: '"+a+"'");let c=new d(t.shift().name);if(null===c.name.match(/^[A-Za-z]$/))throw new i.LambdaParseError("Unexpected token: '"+c.name+"'");if("-"!==(a=t.shift()).name)throw new i.LambdaParseError("Unexpected token: '"+a+"'");if(">"!==(a=t.shift()).name)throw new i.LambdaParseError("Unexpected token: '"+a+"'");let f=o.parseSymbols(t,e);return new E(s,h,u,c,f)}extractMacros(){return new E(this.state.extractMacros(),this.ifNil.extractMacros(),this.head,this.tail,this.ifElse.extractMacros())}}e.Case=E;class L extends u{constructor(t,e){super("Fix"),this.boundvar=t,this.expr=e}getFV(){if(void 0!==this.freevars)return this.freevars;let t=[];for(let e of this.expr.getFV())e.equals(this.boundvar)||t.push(e);return this.freevars=t}toString(t){let e="[fix]"+this.boundvar.toString(!1)+"."+this.expr.toString(!0);return t||(e="("+e+")"),e}substitute(t,e){if(this.boundvar.equals(t))return this;if(d.contains(e.getFV(),this.boundvar)){let n=d.union(this.expr.getFV(),e.getFV()),r=d.getNew(n);return new L(r,this.expr.substitute(this.boundvar,r)).substitute(t,e)}return new L(this.boundvar,this.expr.substitute(t,e))}equals(t){return t instanceof L&&t.boundvar.equals(this.boundvar)&&t.expr.equals(this.expr)}equalsAlpha(t){if(!(t instanceof L))return!1;if(this.equals(t))return!0;let e=this.boundvar,n=this.expr,r=t.boundvar,i=t.expr;return d.contains(n.getFV(),r)?i.equalsAlpha(n):i.equalsAlpha(n.substitute(e,r))}getEquations(t,e,n){this.boundvar.type=e;let r=this.expr.getEquations(t.concat(this.boundvar),e,!0),i=r.proofTree;return i+="\\RightLabel{\\scriptsize(fix)}\n",i+="\\UnaryInfC{$"+d.gammaToTexString(t)+" \\vdash "+this.toTexString(n)+" : "+e.toTexString()+" $}\n",new h(r.eqs,i)}toTexString(t){let e="{\\bf fix}~"+this.boundvar.toTexString(!0)+"."+this.expr.toTexString(!0);return t||(e="("+e+")"),e}getRedexes(t,e,n){if(!t)throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className);return[new a.TypedRedex(this,this.expr.substitute(this.boundvar,new L(new d(this.boundvar.name),this.expr)),"fix")]}getLeftMostRedex(t,e,n){if(!t)throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className);return new a.TypedRedex(this,this.expr.substitute(this.boundvar,new L(new d(this.boundvar.name),this.expr)),"fix")}static parse(t,e){let n=t.shift();if(null===n.name.match(/^[A-Za-z]$/))throw new i.LambdaParseError("Unexpected token: '"+n+"'");let r=new d(n.name);if("."!==t.shift().name)throw new i.LambdaParseError("'.' is expected");let s=o.parseSymbols(t,e);return new L(r,s)}extractMacros(){return new L(this.boundvar,this.expr.extractMacros())}}e.Fix=L},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(0),i=n(1);function s(t,e){let n=null;for(;t.length>0;){let a=t.shift();if(a instanceof i.Const||a instanceof i.Nil||a instanceof i.Macro)n=null===n?a:new i.Application(n,a);else switch(a.name){case"\\":case"¥":case"λ":return null===n?i.LambdaAbstraction.parse(t,e):new i.Application(n,i.LambdaAbstraction.parse(t,e));case"(":{let a=[],o=1;for(;;){if(0===t.length)throw new r.LambdaParseError("Too many LPAREN '('");let e=t.shift();if("("===e.name?o++:")"===e.name&&o--,0===o)break;a.push(e)}let l=s(a,e);n=null===n?l:new i.Application(n,l);break}default:if(e)switch(a.name){case"if":return i.If.parse(t,e);case"let":return i.Let.parse(t,e);case"case":return i.Case.parse(t,e);case"fix":return i.Fix.parse(t,e);case":":{let a=t.shift();if(":"!==a.name)throw new r.LambdaParseError("Unexpected token: '"+a+"'");return new i.List(n,s(t,e))}}if(null===a.name.match(/^[A-Za-z]$/))throw new r.LambdaParseError("Unexpected token: '"+a+"'");n=null===n?new i.Variable(a.name):new i.Application(n,new i.Variable(a.name))}}if(null===n)throw new r.LambdaParseError("No contents in Expression");return n}e.parseSymbols=s,e.makeAST=function(t,e){return s(function(t,e){let n=t.split(""),s=[];for(;n.length>0;){let t=n.shift().trim();if(""===t);else if("<"===t){let a="";for(;;){if(0==n.length)throw new r.LambdaParseError("Too many LANGLE '<'");if(">"===(t=n.shift()))break;a+=t}s.push(i.Macro.get(a,e))}else if(e&&"["===t){let e="";for(;;){if(0==n.length)throw new r.LambdaParseError("Too many LBRACKET '['");if("]"===(t=n.shift()))break;e+=t}let a=null;switch(e){case"nil":a=new i.Nil;break;case"false":case"true":a=new i.ConstBool("true"===e);break;case"if":case"then":case"else":case"let":case"in":case"case":case"of":case"fix":a=new i.Symbol(e);break;default:a=null!==e.match(/^\d+$|^-\d+$/)?new i.ConstInt(parseInt(e)):new i.ConstOp(e)}if(null===a)throw new r.LambdaParseError("Unknown Const: ["+e+"]");s.push(a)}else s.push(new i.Symbol(t))}return s}(t,e),e)},e.parseLMNtal=function(t){return function t(n,s,a){let o=(n=n.trim()).match(/^.+?(?=\()/);if(null===o){let t=a[n];if(void 0===t)throw new r.LambdaParseError("Malformed LMNtal Lambda Term. Unknown Token: "+n);return new i.Variable(t)}let l=o[0].trim(),h=e(n.match(/\(.+$/)[0]);switch(l){case"lambda":{if(2!==h.length)throw new r.LambdaParseError("Malformed LMNtal Lambda Term. lambda(X,A) should have 2 args.");let n=i.Variable.getNew(s),o=function t(n){let i=(n=n.trim()).match(/^.+?(?=\()/);if(null===i)return"rm"===n?[]:[n];let s=i[0].trim(),a=e(n.match(/\(.+$/)[0]);if("rm"===s){if(0!==a.length)throw new r.LambdaParseError("Malformed LMNtal Lambda Term. rm() should have 0 args.");return[]}if("cp"===s){if(2!==a.length)throw new r.LambdaParseError("Malformed LMNtal Lambda Term. cp(A,B) should have 2 args.");return t(a[0].trim()).concat(t(a[1].trim()))}throw new r.LambdaParseError("Malformed LMNtal Lambda Term. Unexpected atom name: "+s)}(h[0]);for(let t of o)a[t]=n.name;return new i.LambdaAbstraction(n,t(h[1],s.concat(n),Object.assign({},a)))}case"apply":if(2!==h.length)throw new r.LambdaParseError("Malformed LMNtal Lambda Term. apply(A,B) should have 2 args.");return new i.Application(t(h[0],[].concat(s),Object.assign({},a)),t(h[1],[].concat(s),Object.assign({},a)));case"fv":if(1!==h.length)throw new r.LambdaParseError("Malformed LMNtal Lambda Term. fv(X) should have 1 arg.");return 1===h[0].length&&h[0].match(/[a-z]/)?new i.Variable(h[0]):i.Macro.get(h[0],!1);default:throw new r.LambdaParseError("Malformed LMNtal Lambda Term. Unexpected atom name: "+l)}}(t,[],{});function e(t){if("("!==(t=t.trim())[0]||")"!==t[t.length-1])throw new r.LambdaParseError("Malformed LMNtal Lambda Term. Invalid Parentheses.");let e=0,n="",i=[];for(let r=1;r<t.length-1;r++){let s=t[r];"("===s?e++:")"===s&&e--,0===e&&","===s?(i.push(n),n=""):n+=s}if(0!==e)throw new r.LambdaParseError("Malformed LMNtal Lambda Term. Invalid Parentheses.");if(i.push(n),1===i.length){let t=i[0].trim();return""===t?[]:[t]}let s=[];for(let t of i)s.push(t.trim());return s}},e.makeChurchNum=function(t){let e=0===t?"z":"sz";for(let n=1;n<t;n++)e="s("+e+")";return"\\sz."+e},e.makeTerms=function(t){return function t(e,n){let r=[].concat(e);if(0===n)return r;let s=t(e,n-1);for(let t=0;t<s.length;t++)for(let e=0;e<s.length;e++)r.push(new i.Application(s[t],s[e]));let a=i.Variable.getNew(e),o=t(e.concat(a),n-1);for(let t of o)r.push(new i.LambdaAbstraction(a,t));return r}([],t)},e.htmlEscape=function(t){return t.replace(/[&'`"<>]/g,function(t){return{"&":"&amp;","'":"&#x27;","`":"&#x60;",'"':"&quot;","<":"&lt;",">":"&gt;"}[t]})},e.putParens=function(t,e){return e?t:"("+t+")"}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(1),i=n(4),s=n(8),a=n(5),o=n(2),l=n(6);class h{constructor(t,e,n,i){let a=t.split("#")[0].trim(),l=[];for(;;){let t=a.match(/^[^[]+?\s*=\s*/);if(null===t)break;let e=t[0];(t=a.split(e)).shift(),a=t.join(e),l.push(e.split(/\s*=\s*$/)[0])}this.expr=o.makeAST(a,e),this.original=this.expr,this.type=this.getType(e);for(let t of l)r.Macro.add(t,this,e);this.typed=e,this.etaAllowed=n,this.allowMultipleEdges=i,this.processTex="\\begin{eqnarray*}\n&& ",this.curStep=0,this.root=s.ReductionNode.makeRoot(this.expr,this.typed,this.etaAllowed,this.allowMultipleEdges),this.curNodes=[this.root],this.nextRedexes=void 0}getRedexes(){return this.nextRedexes?this.nextRedexes:this.nextRedexes=this.expr.getRedexes(this.typed,this.etaAllowed,!0).sort(a.Redex.compare)}getLeftMostRedex(){return this.typed?this.getRedexes()[0]||null:this.nextLeftMostRedex?this.nextLeftMostRedex:this.nextLeftMostRedex=this.expr.getLeftMostRedex(this.typed,this.etaAllowed,!0)}reduction(t){if(void 0===t&&!(t=this.getLeftMostRedex()))return null;let e;if(this.expr=t.next,this.nextRedexes=void 0,this.nextLeftMostRedex=void 0,this.processTex+=t.toTexString(),"macro"===t.type?(this.processTex+=" \\\\\n&\\equiv& ",e="-: (macro) = "+this.expr.toString(!0)):(this.processTex+=" \\\\\n&\\longrightarrow_{"+t.getTexRule()+"}& ",e=++this.curStep+": ("+t.rule+") --\x3e "+this.expr.toString(!0)),!this.hasNext()){e+="    (normal form)\n";let t=this.parseChurchNum();null!==t&&(e+="  = "+t+" (as nat)\n");let n=this.parseChurchBool();null!==n&&(e+="  = "+n+" (as bool)\n"),e=e.slice(0,-1)}return e}deepen(t){if(0===this.curNodes.length)return null;let e=this.curNodes.shift();if(void 0!==t&&e.depth>=t)return this.curNodes.push(e),null;let n=e.visit();for(let t of n.nodes)this.curNodes.push(t);return n}hasNext(){return null!==this.getLeftMostRedex()}hasNodes(){return this.curNodes.length>0}getProofTree(){return"\\begin{prooftree}\n"+this.proofTree+"\\end{prooftree}"}getProcessTex(){return this.processTex+this.expr.toTexString(!0)+(this.hasNext()?"":"\\not\\longrightarrow")+"\n\\end{eqnarray*}"}getType(t){if(!t)return new i.TypeUntyped;i.TypeVariable.maxId=void 0;let e=i.TypeVariable.getNew(),n=this.expr.getEquations([],e,!0),r=n.eqs;this.proofTree=n.proofTree;let s=i.TypeEquation.get(e,i.TypeEquation.solve(r)),a=s.getVariables(),o=[];for(let t of a)i.TypeVariable.contains(o,t)||o.push(t);let l=0;for(let t of o)s.replace(t,i.TypeVariable.getAlphabet(l)),l++;return s}static parseMacroDef(t,e){let n=t.split("#")[0].trim(),i=[];for(;;){let t=n.match(/^[^[]+?\s*=\s*/);if(null===t)break;let e=t[0];(t=n.split(e)).shift(),n=t.join(e),i.push(e.split(/\s*=\s*$/)[0])}if(0===i.length)return null;let s=new h(n,e,!1,!1);for(let t of i)r.Macro.add(t,s,e);return{names:i,expr:s.expr.toString(!0),type:s.type.toString()}}static fileInput(t,e){let n=t.split("\n"),r=[],i=[];for(let t of n)try{let n=h.parseMacroDef(t,e);null!==n&&i.push(n)}catch(t){r.push(t.toString())}return{defs:i,errs:r}}static getMacroList(t){let e="",n=r.Macro.getMap(t);for(let t in n){let r=n[t];e+="<"+r.name+"> is defined as "+r.expr.toString(!0)+" : "+r.type+"\n"}return e}static getMacroListAsObject(t){return r.Macro.getMap(t)}static clearMacro(t){return r.Macro.clear(t)}static graph2LF(t,e){return s.GraphNode.search(s.GraphNode.parse(t),e)}static lmntal2LF(t){return new h(o.parseLMNtal(t).toString(!0),!1,!1,!1)}static deBrujin2LF(t){return new h(l.deBrujinExpression.parse(t).toLambda().toString(!0),!1,!1,!1)}toLMNtal(){return h.nextLinkID=0,this.typed?null:this.original.toLMNtal()}toSKI(){return this.typed?null:this.original.toSKI().toString(!0)}toDeBrujin(){return this.typed?null:this.original.toDeBrujin().toString()}toString(){let t=this.expr.toString(!0)+" : "+this.type;if(!this.hasNext()){t+="    (normal form)\n";let e=this.parseChurchNum();null!==e&&(t+="  = "+e+" (as nat)\n");let n=this.parseChurchBool();null!==n&&(t+="  = "+n+" (as bool)\n"),t=t.slice(0,t.length-1)}return t}getOriginalString(){return this.original.toString(!0)+" : "+this.type}parseChurchNum(){return this.expr.parseChurchNum()}parseChurchBool(){return this.expr.parseChurchBool()}static getNewLink(){return"R"+h.nextLinkID++}}e.LambdaFriends=h},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(0);class i{constructor(t){this.className=t}}e.Type=i;class s{constructor(t,e){this.left=t,this.right=e}transform(t,e){if(this.left instanceof a&&this.right instanceof a)return this.left.match(this.right);if(this.left.equals(this.right))return[];if(!(this.left instanceof c))return[new s(this.right,this.left)];if(this.right.contains(this.left))throw new r.TypeError("Illegal type ("+this.right+" contains "+this.left+". Self-application?)");for(var n of t)n.replace(this.left,this.right);for(var n of e)n.replace(this.left,this.right);return[this]}static isEqual(t,e){if(t.length!==e.length)return!1;for(var n of t)if(!s.contains(n,e))return!1;return!0}static contains(t,e){for(var n of e)if(t.equals(n))return!0;return!1}equals(t){return t.left.equals(this.left)&&t.right.equals(this.right)}static get(t,e){for(var n of e)if(n.left.equals(t))return n.right;throw new r.TypeError("Undefined TypeVariable: "+t)}toString(){return this.left+" = "+this.right}replace(t,e){this.left.equals(t)?this.left=e:this.left.replace(t,e),this.right.equals(t)?this.right=e:this.right.replace(t,e)}static solve(t){for(;;){for(var e=[].concat(t),n=[];t.length>0;){var r=t.shift().transform(t,n);n=n.concat(r)}if(t=[].concat(n),s.isEqual(e,n))break}return t}}e.TypeEquation=s;class a extends i{}e.TypeConstructor=a;class o extends a{constructor(){super("TypeInt")}toString(){return"int"}toTexString(){return"{\\rm int}"}equals(t){return t instanceof o}match(t){if(t instanceof o)return[];throw new r.TypeError(this+" and "+t+" are not compatible.")}contains(t){return!1}replace(t,e){}getVariables(){return[]}}e.TypeInt=o;class l extends a{constructor(){super("TypeBool")}toString(){return"bool"}toTexString(){return"{\\rm bool}"}equals(t){return t instanceof l}match(t){if(t instanceof l)return[];throw new r.TypeError(this+" and "+t+" are not compatible.")}contains(t){return!1}replace(t,e){}getVariables(){return[]}}e.TypeBool=l;class h extends a{constructor(t){super("TypeList"),this.content=t}toString(){return"list("+this.content+")"}toTexString(){return"{\\rm list}("+this.content.toTexString()+")"}equals(t){return t instanceof h&&this.content.equals(t.content)}match(t){if(t instanceof h)return[new s(this.content,t.content)];throw new r.TypeError(this+" and "+t+" are not compatible.")}contains(t){return this.content.contains(t)}replace(t,e){this.content.equals(t)?this.content=e:this.content.replace(t,e)}getVariables(){return this.content.getVariables()}}e.TypeList=h;class u extends a{constructor(t,e){super("TypeFunc"),this.left=t,this.right=e}toString(){return(this.left instanceof u?"("+this.left+")":this.left.toString())+" -> "+this.right}toTexString(){return(this.left instanceof u?"("+this.left.toTexString()+")":this.left.toTexString())+" \\rightarrow "+this.right.toTexString()}equals(t){return t instanceof u&&(t.left.equals(this.left)&&t.right.equals(this.right))}match(t){if(t instanceof u)return[new s(this.left,t.left),new s(this.right,t.right)];throw new r.TypeError(this+" and "+t+" are not compatible.")}contains(t){return this.left.contains(t)||this.right.contains(t)}replace(t,e){this.left.equals(t)?this.left=e:this.left.replace(t,e),this.right.equals(t)?this.right=e:this.right.replace(t,e)}getVariables(){return this.left.getVariables().concat(this.right.getVariables())}}e.TypeFunc=u;class c extends i{constructor(t){super("TypeVariable"),this.id=t}toString(){return this.id<0?"'"+c.alphabet[-this.id-1]:"'t"+this.id}toTexString(){return this.id<0?c.texAlphabet[-this.id-1]:"\\tau_{"+this.id+"}"}equals(t){return t instanceof c&&this.id===t.id}static getNew(){return void 0===c.maxId?(c.maxId=0,new c(0)):(c.maxId++,new c(c.maxId))}contains(t){return this.equals(t)}replace(t,e){}getVariables(){return[this]}static getAlphabet(t){return new c(-t-1)}static contains(t,e){for(var n of t)if(n.equals(e))return!0;return!1}}c.alphabet="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),c.texAlphabet=["\\alpha","\\beta","\\gamma","\\delta","\\varepsilon","\\zeta","\\eta","\\theta","\\iota","\\kappa","\\mu","\\nu","\\xi","\\pi","\\rho","\\sigma","\\upsilon","\\phi","\\chi","\\psi","\\omega","\\Gamma","\\Delta","\\Theta","\\Xi","\\Pi","\\Sigma","\\Phi","\\Psi","\\Omega"].concat(c.alphabet),e.TypeVariable=c;class d extends i{constructor(){super("TypeUntyped")}toString(){return"Untyped"}toTexString(){return"{\\rm Untyped}"}equals(t){return t instanceof d}contains(t){return!1}replace(t,e){}getVariables(){return[]}}e.TypeUntyped=d},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(1),i=n(2);class s{constructor(t){this.left="",this.right="",this.texLeft="",this.texRight="",this.type=t}addLeft(t){this.left=t+this.left}addRight(t){this.right+=t}addTexLeft(t){this.texLeft=t+this.texLeft}addTexRight(t){this.texRight+=t}static makeNext(t,e,n,r,i,s){let a=[].concat(t);for(let t of a)t.next=s(t.next),t.addLeft(e),t.addRight(n),t.addTexLeft(r),t.addTexRight(i);return a}getName(){return this.type}getPos(){return this.left.length}static compare(t,e){let n=t.getPos(),r=e.getPos();if(n===r){const n=t=>t instanceof a?0:t instanceof o?1:t instanceof l?2:t instanceof h?3:void 0;return n(t)-n(e)}return n-r}}e.Redex=s;class a extends s{constructor(t){super("beta"),this.content=t,this.la=t.left,this.next=this.la.expr.substitute(this.la.boundvar,t.right),this.arg=t.right,this.rule="beta"}toString(){let t=[],e=this.la.expr;for(;e instanceof r.LambdaAbstraction;)t.push(e.boundvar.toString(!1)),e=e.expr;let n=t.join("")+"."+e.toString(!0);return this.left+"(\\["+this.la.boundvar.toString(!1)+"]"+n+")["+this.arg.toString(!1)+"]"+this.right}toTexString(){let t=[],e=this.la.expr;for(;e instanceof r.LambdaAbstraction;)t.push(e.boundvar.toTexString(!1)),e=e.expr;let n=t.join("")+"."+e.toTexString(!0);return this.texLeft+"(\\strut \\lambda{\\underline{"+this.la.boundvar.toTexString(!1)+"}}"+n+")\\underline{\\strut "+this.arg.toTexString(!1)+"}"+this.texRight}toHTMLString(){let t=[],e=this.la.expr;for(;e instanceof r.LambdaAbstraction;)t.push(e.boundvar.toString(!1)),e=e.expr;let n=t.join("")+"."+e.toString(!0);return i.htmlEscape(this.left)+'(\\<span class="lf-beta lf-boundvar">'+i.htmlEscape(this.la.boundvar.toString(!1))+"</span>"+i.htmlEscape(n)+')<span class="lf-beta lf-arg">'+i.htmlEscape(this.arg.toString(!1))+"</span>"+i.htmlEscape(this.right)}getTexRule(){return"\\beta"}}e.BetaRedex=a;class o extends s{constructor(t){super("eta"),this.content=t,this.app=t.expr,this.next=this.app.left,this.rule="eta"}toString(){return this.left+"["+this.content+"]"+this.right}toTexString(){return this.texLeft+"\\underline{\\strut "+this.content.toTexString(this.left+this.right==="")+"}"+this.texRight}toHTMLString(){return i.htmlEscape(this.left)+'<span class="lf-eta">'+i.htmlEscape(this.content.toString(this.left+this.right===""))+"</span>"+i.htmlEscape(this.right)}getTexRule(){return"\\eta"}}e.EtaRedex=o;class l extends s{constructor(t){super("macro"),this.content=t,this.next=t.expr,this.rule="macro"}toString(){return this.left+"[<"+this.content.name+">]"+this.right}toTexString(){return this.texLeft+"\\underline{\\strut "+this.content.toTexString(!1)+"}"+this.texRight}toHTMLString(){return i.htmlEscape(this.left)+'<span class="lf-macro">&lt;'+i.htmlEscape(this.content.name)+"&gt;</span>"+i.htmlEscape(this.right)}getTexRule(){return"{\\rm m}"}}e.MacroRedex=l;class h extends s{constructor(t,e,n){super("typed"),this.content=t,this.next=e,this.rule=n}toString(){return this.left+"["+this.content.toString(this.left+this.right==="")+"]"+this.right}toTexString(){return this.texLeft+"\\underline{\\strut "+this.content.toTexString(!1)+"}"+this.texRight}toHTMLString(){return i.htmlEscape(this.left)+'<span class="lf-typed">'+i.htmlEscape(this.content.toString(this.left+this.right===""))+"</span>"+i.htmlEscape(this.right)}getTexRule(){return"{\\rm ("+this.rule+")}"}}e.TypedRedex=h},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(2),i=n(0),s=n(1);class a{constructor(t){this.className=t}toString(){return this.getString(!0)}static parse(t){let e=t.split(""),n=null;for(;e.length>0;){let t=e.shift();switch(t){case"(":{let t=1,r="";for(;;){if(0===e.length)throw new i.LambdaParseError("Too many LPAREN '('");let n=e.shift();if("("===n&&t++,")"===n&&t--,0===t)break;r+=n}n=null===n?this.parse(r):new l(n,this.parse(r));break}case"\\":case"¥":case"λ":{let t=new o(this.parse(e.join("")));return null===n?t:new l(n,t)}case" ":break;default:{let r;if(null!==t.match(/^[0-9]$/)){let n=t;for(;e.length>0&&null!==e[0].match(/^[0-9]$/);)n+=e.shift();r=new h(parseInt(n))}else{if(null===t.match(/^[a-zA-Z]$/))throw new i.LambdaParseError("Unexpected token: '"+t+"'");{let n=t;for(;e.length>0&&null!==e[0].match(/^[a-zA-Z0-9]$/);)n+=e.shift();r=new u(n)}}n=null===n?r:new l(n,r)}}}if(null===n)throw new i.LambdaParseError("No contents in Expression");return n}toLambda(){return this.getLambda(u.toVariables(this.getFV()))}}e.deBrujinExpression=a;class o extends a{constructor(t){super("deBrujinLambda"),this.expr=t}getString(t){return r.putParens("\\ "+this.expr.getString(!0),t)}getLambda(t){let e=s.Variable.getNew(t);t.unshift(e);let n=this.expr.getLambda(t);return t.shift(),new s.LambdaAbstraction(e,n)}getFV(){return this.expr.getFV()}}e.deBrujinLambda=o;class l extends a{constructor(t,e){super("deBrujinApplication"),this.left=t,this.right=e}getString(t){return r.putParens(this.left.getString(this.left instanceof l)+" "+this.right.getString(!1),t)}getLambda(t){return new s.Application(this.left.getLambda(t),this.right.getLambda(t))}getFV(){return this.left.getFV().concat(this.right.getFV())}}e.deBrujinApplication=l;class h extends a{constructor(t){super("deBrujinIndex"),this.index=t}getString(t){return this.index.toString()}getLambda(t){if(this.index<t.length)return t[this.index];throw new i.TranslateError("de Brujin Index must be less than # of ancestor lambdas.")}getFV(){return[]}}e.deBrujinIndex=h;class u extends a{constructor(t){super("deBrujinFreeVar"),this.name=t}getString(t){return this.name}getLambda(t){return 1===this.name.length?this.toVariable():s.Macro.get(this.name,!1)}toVariable(){return new s.Variable(this.name)}static toVariables(t){let e=[];for(let n of t)e.push(n.toVariable());return e}getFV(){return[this]}}e.deBrujinFreeVar=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(3);let i=cytoscape({container:document.getElementById("graph"),boxSelectionEnabled:!1,autounselectify:!0,style:[{selector:"node",style:{label:"data(label)","background-color":"#11479e"}},{selector:"edge",style:{"target-arrow-shape":"triangle","curve-style":"bezier","target-arrow-color":"#9dbaea",width:3,"line-color":"#9dbaea"}},{selector:".goal",style:{"background-color":"#b3424a"}},{selector:".root",style:{"background-color":"#407f5d"}},{selector:".goal.root",style:{"background-color":"#d17200"}}]});MicroModal.init({disableScroll:!1,awaitCloseAnimation:!0});let s=void 0,a=!0,o=!1,l=!1,h=void 0,u=document.getElementById("input"),c=document.getElementById("output"),d=document.getElementById("untyped"),f=document.getElementById("typed"),p=document.getElementById("etaEnable"),g=document.getElementById("etaDisable"),m=document.getElementById("multiEdgeEnable"),x=document.getElementById("multiEdgeDisable"),b=document.getElementById("fileInput"),w=new FileReader,y=document.getElementById("clearMacroBtn"),T=document.getElementById("translate"),v=document.getElementById("tabA"),S=document.getElementById("outputBtns"),E=document.getElementById("stepInput"),L=document.getElementById("startGraph"),R=document.getElementById("stopGraph"),q=document.getElementById("imgGraph"),M=document.getElementById("maxDepth"),N=document.getElementById("tabAbtn"),F=document.getElementById("tabBbtn"),I=document.getElementById("tabC1btn"),k=document.getElementById("tabC2btn"),B=document.getElementById("tabDbtn"),V=document.getElementById("lmnInput"),A=document.getElementById("lmnSubmit"),C=document.getElementById("lmnOutput"),P=document.getElementById("deBrujinInput"),j=document.getElementById("deBrujinSubmit"),U=document.getElementById("deBrujinOutput"),$=document.getElementById("graphInput"),z=document.getElementById("graphSubmit"),D=document.getElementById("graphOutput");b.addEventListener("change",function(t){let e=t.target.files[0];if("text/plain"!==e.type)return alert("プレーンテキストを選択してください"),void(b.value="");w.readAsText(e)}),w.addEventListener("load",function(){let t=r.LambdaFriends.fileInput(w.result,a);st();let e=document.getElementById("fileInputLog");if(e.textContent=null,t.defs.length>0){let n=document.createElement("div"),r=document.createElement("p");r.innerText="Finally, "+t.defs.length+" macros are successfully added.";let i=document.createElement("ul");i.className="code";for(let e of t.defs){let t=document.createElement("li"),n=[].concat(e.names),r="<"+n.shift()+">";for(;n.length>0;){r+=" = <"+n.shift()+">"}t.innerText=r+" is defined as "+e.expr+" : "+e.type,i.appendChild(t)}n.appendChild(r),n.appendChild(i),e.appendChild(n)}if(t.errs.length>0){let n=document.createElement("div"),r=document.createElement("p");r.innerText="Unfortunately, "+t.errs.length+" macros are rejected due to some errors.";let i=document.createElement("ul");i.className="code";for(let e of t.errs){let t=document.createElement("li");t.innerText=e,i.appendChild(t)}n.appendChild(r),n.appendChild(i),e.appendChild(n)}MicroModal.show("modal-1",{debugMode:!0,disableScroll:!0,awaitCloseAnimation:!0})}),d.onclick=function(){d.className="btn btn-primary",f.className="btn btn-default",a=!1,p.disabled=!1,g.disabled=!1,m.disabled=!1,x.disabled=!1,st()},f.onclick=function(){f.className="btn btn-primary",d.className="btn btn-default",a=!0,p.disabled=!0,g.disabled=!0,m.disabled=!0,x.disabled=!0,st()},p.onclick=function(){p.className="btn btn-primary",g.className="btn btn-default",o=!0},g.onclick=function(){g.className="btn btn-primary",p.className="btn btn-default",o=!1},m.onclick=function(){m.className="btn btn-primary",x.className="btn btn-default",l=!0},x.onclick=function(){x.className="btn btn-primary",m.className="btn btn-default",l=!1},y.onclick=function(){r.LambdaFriends.clearMacro(a),st()},E.addEventListener("change",function(){let t=parseInt(E.value);s=isNaN(t)?void 0:t});let O=[],_=0,K=[""],H=function(){let t=u.value;if(""!==t||void 0===h){O.unshift(t),_=0,(K=[].concat(O)).unshift(""),t=(t=t.split("#")[0]).trim();try{let e=r.LambdaFriends.parseMacroDef(t,a);if(null===e)h=new r.LambdaFriends(t,a,o,l),X=0,i.remove("*"),i.add(dt(h.root)),ft(),rt(h.toString()),a&&ut(),ct();else{let t=[].concat(e.names),n="<"+t.shift()+">";for(;t.length>0;){n+=" = <"+t.shift()+">"}rt(n+=" is defined as "+e.expr+" : "+e.type),S.textContent=null}ot()}catch(t){rt(t.toString()),console.log(t),S.textContent=null}st(),u.value=""}else W?Q():ut()};document.getElementById("submit").onclick=H,document.getElementById("input").onkeydown=function(t){13===t.keyCode?(H(),t.preventDefault()):38===t.keyCode?(_<K.length-1&&(K[_]=u.value,_++,u.value=K[_]),t.preventDefault()):40===t.keyCode&&(_>0&&(K[_]=u.value,_--,u.value=K[_]),t.preventDefault())};let G,Z=!1,X=0,J=!1;function Q(){if(J)return;if(ft(),void 0===h)return;Z=!1,J=!0,X+=G||10;let t=()=>setTimeout(()=>{if(Z)return ft(),void(J=!1);let e=h.deepen(X);if(null===e)return ft(),void(J=!1);let n=[];for(let t of e.nodes)n.push(dt(t));for(let t of e.edges)n.push({group:"edges",data:{source:t.from.id.toString(),target:t.to.id.toString()}});ft(),i.add(n),t(),ft()},1);t()}L.onclick=Q,R.onclick=function(){Z=!0},q.onclick=function(){window.open(i.png())},M.addEventListener("change",function(){let t=parseInt(M.value);G=isNaN(t)?void 0:t});let W=!1;function Y(){let t=V.value;try{let e=r.LambdaFriends.lmntal2LF(t);C.innerText="Found: "+e.expr.toString(!0)}catch(t){C.innerText=t.toString()}}function tt(){let t=P.value;try{let e=r.LambdaFriends.deBrujin2LF(t);U.innerText="Found: "+e.expr.toString(!0)}catch(t){U.innerText=t.toString()}}function et(){let t=$.value;try{let e=r.LambdaFriends.graph2LF(t,l);D.innerText=null===e?"Not Found":"Found: "+e.expr.toString(!0)}catch(t){D.innerText=t.toString()}}N.addEventListener("click",()=>{W=!1}),F.addEventListener("click",()=>{W=!1}),I.addEventListener("click",()=>{W=!1}),k.addEventListener("click",()=>{W=!1}),B.addEventListener("click",()=>{setTimeout(ft,10),W=!0}),V.onkeydown=function(t){13===t.keyCode&&(Y(),t.preventDefault())},A.onclick=Y,P.onkeydown=function(t){13===t.keyCode&&(tt(),t.preventDefault())},j.onclick=tt,$.onkeydown=function(t){13===t.keyCode&&(et(),t.preventDefault())},z.onclick=et;let nt="";function rt(t){nt=t+"\n",c.innerHTML=at(nt)}function it(t){nt+=t+"\n",c.innerHTML=at(nt)}function st(){let t=document.getElementById("macroList");t.innerHTML="";let e=r.LambdaFriends.getMacroListAsObject(a);for(let n in e){let r=e[n];t.innerHTML+="<tr><th>"+at(r.name)+"</th><td>"+at(r.expr.toString(!0))+"</td><td>"+at(r.type.toString())+"</td></tr>"}}function at(t){return t.replace(/[&'`"<> \n]/g,function(t){return{"&":"&amp;","'":"&#x27;","`":"&#x60;",'"':"&quot;","<":"&lt;",">":"&gt;"," ":"&nbsp;","\n":"<br>"}[t]})}function ot(){if(T.textContent=null,void 0===h)return;let t=document.createElement("h4");t.innerText=h.getOriginalString(),T.appendChild(t),T.appendChild(lt("これまでの簡約過程",h.getProcessTex())),a?T.appendChild(lt("型付けの証明木",h.getProofTree())):(T.appendChild(lt("LMNtalコード",h.toLMNtal())),T.appendChild(lt("SKIコンビネータ",h.toSKI())),T.appendChild(lt("de Brujin Index",h.toDeBrujin())))}function lt(t,e){let n=document.createElement("p"),r=document.createElement("button"),i=document.createElement("span"),s=document.createElement("div"),a=document.createElement("p");s.classList.add("code"),n.appendChild(r),n.appendChild(i),s.appendChild(a),a.innerText=e,i.innerText=t,r.type="button",r.className="btn btn-default btn-sm",r.innerText="クリップボードにコピー",r.onclick=function(){let t=document.getSelection();t.selectAllChildren(s),document.execCommand("copy"),t.collapse(document.body,0)};let o=document.createElement("div");return o.appendChild(n),o.appendChild(s),o}let ht=!1;function ut(){if(ht)return;ht=!0,S.textContent=null;let t=e=>setTimeout(()=>{if(0===e||!h.hasNext())return ct(),v.scrollTop=c.offsetHeight-15,void(ht=!1);it(h.reduction()),v.scrollTop=c.offsetHeight-15,ot(),t(e-1)},1);t(void 0===s?100:s)}function ct(){if(!h.hasNext())return void(S.textContent=null);let t=document.createElement("button");if(t.type="button",t.className="btn btn-default btn-sm",t.innerText="最左簡約を続ける",t.onclick=ut,S.textContent=null,S.appendChild(t),a)return;let e=document.createElement("span");e.innerText="または、以下から簡約基を選ぶ：",S.appendChild(e);let n=document.createElement("div");n.className="list-group",S.appendChild(n);let r=h.getRedexes();for(let t of r){let e=document.createElement("button");e.className="list-group-item code",e.innerHTML=t.toHTMLString(),e.onclick=function(){it(h.reduction(t)),ct(),v.scrollTop=c.offsetHeight-15,ot()},n.appendChild(e)}}function dt(t){return{group:"nodes",data:{id:""+t.id,label:""+t.toString()},classes:(t.isNormalForm?"goal ":"")+(t.isRoot?"root":"")}}function ft(){i.resize(),i.elements().makeLayout({name:"dagre",nodeSpacing:5,animate:!0,randomize:!1,maxSimulationTime:1500}).run()}d.onclick(null),g.onclick(null),x.onclick(null),st()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(0),i=n(3);class s{constructor(t,e,n){this.children=[],this.label=t,this.info=e,this.id=e.nextId++,this.isRoot=n,e.nodes.push(this)}toString(){return this.label}equalsShape(t){return this.info.nodes.length===t.info.nodes.length&&this.info.edges.length===t.info.edges.length&&this.info.allowMultipleEdges===t.info.allowMultipleEdges&&function t(e,n,r){if(e.children.length!==n.children.length)return!1;r.push({n1:e,n2:n});let i=[].concat(n.children);let s=!0;for(let n of e.children){let e=!1;for(let s=0;s<i.length;s++){let a=i[s],o=void 0;for(let t of r)if(t.n1.id===n.id||t.n2.id===a.id){o=t;break}if(void 0===o&&t(n,a,r)||void 0!==o&&o.n1.id===n.id&&o.n2.id===a.id){i.splice(s,1),e=!0;break}}if(!e){s=!1;break}}for(let t=0;t<r.length;t++)if(r[t].n1.id===e.id)return r.splice(t,1),s;throw new Error("Unexpected Error")}(this,t,[])}static parse(t){let e=t.split(";"),n=new a([],[],null,null,0,!1),i={};for(let t of e){let e=t.split("->"),r=o(e[0]);for(let t=1;t<e.length;t++){let i=o(e[t]);for(let t of r)for(let e of i)n.hasEdge({from:t,to:e})&&(n.allowMultipleEdges=!0),n.edges.push({from:t,to:e}),t.children.push(e);r=i}}if(void 0===i.root)throw new r.GraphParseError("there must be a 'root' node.");return i.root;function o(t){let e=t.split(","),a=[];for(let t of e){if(""===(t=t.trim()))continue;if(!/^[a-z][a-z0-9]*$/.test(t))throw new r.GraphParseError("the name '"+t+"' cannot be used as node name, must be [a-z][a-z0-9]*");let e=i[t];void 0===e&&(e=i[t]=new s(t,n,"root"===t)),a.push(e)}return a}}static search(t,e){let r,s="graph_closure.csv";try{let t=new XMLHttpRequest;t.open("GET",s,!1),t.send(null),r=t.responseText}catch(t){0;let e=n(9);try{e.statSync(s)}catch(t){return void console.error("File Not Found: "+s)}r=e.readFileSync(s,"utf8")}let a=r.split("\n");for(let n of a){let r=n.split(",");if(parseInt(r[2])===t.info.nodes.length&&parseInt(r[3])===t.info.edges.length){let n=new i.LambdaFriends(r[0],!1,!1,e);for(;null!==n.deepen(););if(n.root.equalsShape(t))return n}}return null}}e.GraphNode=s;class a{constructor(t,e,n,r,i,s){this.nodes=t,this.edges=e,this.typed=n,this.etaAllowed=r,this.nextId=i,this.allowMultipleEdges=s}hasEdge(t){for(let e of this.edges)if(e.from.id===t.from.id&&e.to.id===t.to.id)return!0;return!1}}class o extends s{constructor(t,e,n,r){super((t=t.extractMacros()).toString(!0),n,r),this.expr=t,this.parent=e,this.depth=null===e?0:e.depth+1,this.nextrs=this.expr.getRedexes(n.typed,n.etaAllowed,!0),this.isNormalForm=0===this.nextrs.length}static makeRoot(t,e,n,r){return new o(t,null,new a([],[],e,n,0,r),!0)}visit(){let t={nodes:[],edges:[]};for(let e of this.nextrs){let n=this.find(e.next);if(null===n){let n=new o(e.next,this,this.info,!1);this.children.push(n),t.nodes.push(n),!this.info.allowMultipleEdges&&this.info.hasEdge({from:this,to:n})||(t.edges.push({from:this,to:n}),this.info.edges.push({from:this,to:n}))}else this.children.push(n),!this.info.allowMultipleEdges&&this.info.hasEdge({from:this,to:n})||(t.edges.push({from:this,to:n}),this.info.edges.push({from:this,to:n}))}return t}find(t){for(let e of this.info.nodes)if(e.expr.equalsAlpha(t))return e;return null}}e.ReductionNode=o},function(t,e){t.exports=require("fs")}]);