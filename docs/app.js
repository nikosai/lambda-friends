!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=7)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e,t){void 0===t?(this.name="LambdaFriendsError",this.message=e):(this.name=e,this.message=t)}toString(){return this.name+": "+this.message}}t.LambdaFriendsError=r;t.LambdaParseError=class extends r{constructor(e){super("LambdaParseError",e)}};t.SubstitutionError=class extends r{constructor(e){super("SubstitutionError",e)}};t.ReductionError=class extends r{constructor(e){super("ReductionError",e)}};t.MacroError=class extends r{constructor(e){super("MacroError",e)}};t.TypeError=class extends r{constructor(e){super("TypeError",e)}};t.TexError=class extends r{constructor(e){super("TexError",e)}};t.GraphParseError=class extends r{constructor(e){super("GraphParseError",e)}};t.TranslateError=class extends r{constructor(e){super("TranslateError",e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(4),i=n(0),s=n(3),a=n(5),o=n(2),l=n(6);class u{constructor(e,t){this.eqs=e,this.proofTree=t}}class h{constructor(e){this.className=e}parseChurchNum(){if(!(this instanceof w))return null;const e=this.boundvar;let t=this.expr,n=0;if(!(t instanceof w))return null;const r=t.boundvar;if(e.equals(r))return null;for(t=t.expr;t instanceof y;){if(n++,!t.left.equals(e))return null;t=t.right}return t.equals(r)?n:null}parseChurchBool(){const e=new w(new c("x"),new w(new c("y"),new c("x"))),t=new w(new c("x"),new w(new c("y"),new c("y")));return!!this.equalsAlpha(e)||!this.equalsAlpha(t)&&null}toLMNtal(){throw new i.TypeError("Expression '"+this+"' cannot be converted into LMNtal (untyped only).")}toSKI(){throw new i.TypeError("Expression '"+this+"' cannot be converted to SKI combinators (untyped only).")}getDeBrujin(e){throw new i.TypeError("Expression '"+this+"' cannot be converted to de Brujin indexes (untyped only).")}toDeBrujin(){return this.getDeBrujin([])}}t.Expression=h;class d extends h{constructor(e,t){super(void 0===t?"Symbol":t),this.name=e}equals(e){return e instanceof d&&e.className===this.className&&e.name===this.name}equalsAlpha(e){return e instanceof d&&e.className===this.className&&e.name===this.name}toString(e){return this.name}toTexString(e){throw new i.TexError("class Symbol does not have tex string")}getFV(){return this.freevars}substitute(e,t){throw new i.SubstitutionError("Undefined Substitution")}getEquations(e,t,n){throw new i.TypeError("Undefined Type")}getRedexes(e,t){throw new i.ReductionError("Symbols must not appear in parsed Expression")}getTypedRedex(e){throw new i.ReductionError("Symbols must not appear in parsed Expression")}getLeftMostRedex(e,t){throw new i.ReductionError("Symbols must not appear in parsed Expression")}extractMacros(){throw new i.ReductionError("Symbols must not appear in parsed Expression")}}t.Symbol=d;class c extends d{constructor(e){super(e,"Variable"),this.freevars=[this]}substitute(e,t){return this.equals(e)?t:this}getEquations(e,t,n){for(let n of e)if(n.equals(this)){let i="\\AxiomC{}\n";return i+="\\RightLabel{\\scriptsize(var)}\n",i+="\\UnaryInfC{$"+c.gammaToTexString(e)+" \\vdash "+this.name+" : "+t.toTexString()+" $}\n",new u([new r.TypeEquation(n.type,t)],i)}throw new i.TypeError("free variable is not allowed: "+this)}toTexString(e){return this.name}static union(e,t,n){if(void 0===n){let n=[];for(let t of e)n.push(t);for(let r of c.dif(t,e))n.push(r);return n}return c.union(c.union(e,t),n)}static dif(e,t){let n=[];for(let r of e)c.contains(t,r)||n.push(r);return n}static contains(e,t){for(let n of e)if(n.equals(t))return!0;return!1}static gammaToTexString(e){if(0===e.length)return"";let t=e[0].name+" : "+e[0].type.toTexString();for(let n=1;n<e.length;n++)t+=",~"+e[n].name+" : "+e[n].type.toTexString();return t}static getNew(e){let t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");for(let n of t){let t=new c(n);if(!c.contains(e,t))return t}throw new i.SubstitutionError("No more Variables available")}getRedexes(e,t){return[]}getTypedRedex(e){return null}getLeftMostRedex(e,t){return null}extractMacros(){return this}toLMNtal(){return"fv("+this.name+")"}toSKI(){return this}getDeBrujin(e){for(let t=0;t<e.length;t++)if(e[t].equals(this))return new l.deBrujinIndex(t);return new l.deBrujinFreeVar(this.name)}}t.Variable=c;class p extends d{constructor(e,t){super(e,t),this.freevars=[]}substitute(e,t){return this}getEquations(e,t,n){let i="\\AxiomC{}\n";return i+="\\RightLabel{\\scriptsize(con)}\n",i+="\\UnaryInfC{$"+c.gammaToTexString(e)+" \\vdash "+this.toTexString(n)+" : "+t.toTexString()+" $}\n",new u([new r.TypeEquation(this.type,t)],i)}toString(e){return"["+this.name+"]"}toTexString(e){return this.name+"^{"+this.type.toTexString()+"}"}getRedexes(e,t){throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className)}getTypedRedex(e){return null}getLeftMostRedex(e,t){throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className)}extractMacros(){return this}}t.Const=p;class f extends p{constructor(e){super(e.toString(),"ConstInt"),this.value=e,this.type=new r.TypeInt}}t.ConstInt=f;class g extends p{constructor(e){super(e.toString(),"ConstBool"),this.value=e,this.type=new r.TypeBool}}t.ConstBool=g;class m extends p{constructor(e){switch(super(e,"ConstOp"),e){case"+":this.value=((e,t)=>new f(e.value+t.value)),this.type=new r.TypeFunc(new r.TypeInt,new r.TypeFunc(new r.TypeInt,new r.TypeInt));break;case"-":this.value=((e,t)=>new f(e.value-t.value)),this.type=new r.TypeFunc(new r.TypeInt,new r.TypeFunc(new r.TypeInt,new r.TypeInt));break;case"*":this.value=((e,t)=>new f(e.value*t.value)),this.type=new r.TypeFunc(new r.TypeInt,new r.TypeFunc(new r.TypeInt,new r.TypeInt));break;case"/":this.value=((e,t)=>{if(0===t.value)throw new i.ReductionError("Dividing by '0' is not allowed");return new f(Math.floor(e.value/t.value))}),this.type=new r.TypeFunc(new r.TypeInt,new r.TypeFunc(new r.TypeInt,new r.TypeInt));break;case"%":this.value=((e,t)=>{if(0===t.value)throw new i.ReductionError("Dividing by '0' is not allowed");return new f(e.value-4*Math.floor(e.value/t.value))}),this.type=new r.TypeFunc(new r.TypeInt,new r.TypeFunc(new r.TypeInt,new r.TypeInt));break;case"<":this.value=((e,t)=>new g(e.value<t.value)),this.type=new r.TypeFunc(new r.TypeInt,new r.TypeFunc(new r.TypeInt,new r.TypeBool));break;case">":this.value=((e,t)=>new g(e.value>t.value)),this.type=new r.TypeFunc(new r.TypeInt,new r.TypeFunc(new r.TypeInt,new r.TypeBool));break;case"<=":this.value=((e,t)=>new g(e.value<=t.value)),this.type=new r.TypeFunc(new r.TypeInt,new r.TypeFunc(new r.TypeInt,new r.TypeBool));break;case">=":this.value=((e,t)=>new g(e.value>=t.value)),this.type=new r.TypeFunc(new r.TypeInt,new r.TypeFunc(new r.TypeInt,new r.TypeBool));break;case"==":case"=":this.value=((e,t)=>new g(e.value==t.value)),this.type=new r.TypeFunc(new r.TypeInt,new r.TypeFunc(new r.TypeInt,new r.TypeBool));break;case"!=":this.value=((e,t)=>new g(e.value!=t.value)),this.type=new r.TypeFunc(new r.TypeInt,new r.TypeFunc(new r.TypeInt,new r.TypeBool));break;case"eq":this.value=((e,t)=>new g(e.value==t.value)),this.type=new r.TypeFunc(new r.TypeBool,new r.TypeFunc(new r.TypeBool,new r.TypeBool));break;case"xor":this.value=((e,t)=>new g(e.value!=t.value)),this.type=new r.TypeFunc(new r.TypeBool,new r.TypeFunc(new r.TypeBool,new r.TypeBool));break;case"or":this.value=((e,t)=>new g(e.value||t.value)),this.type=new r.TypeFunc(new r.TypeBool,new r.TypeFunc(new r.TypeBool,new r.TypeBool));break;case"and":this.value=((e,t)=>new g(e.value&&t.value)),this.type=new r.TypeFunc(new r.TypeBool,new r.TypeFunc(new r.TypeBool,new r.TypeBool));break;case"nor":this.value=((e,t)=>new g(!(e.value||t.value))),this.type=new r.TypeFunc(new r.TypeBool,new r.TypeFunc(new r.TypeBool,new r.TypeBool));break;case"nand":this.value=((e,t)=>new g(!(e.value&&t.value))),this.type=new r.TypeFunc(new r.TypeBool,new r.TypeFunc(new r.TypeBool,new r.TypeBool));break;default:throw new i.LambdaParseError("Undefined function: "+e)}}}t.ConstOp=m;class x extends d{substitute(e,t){return this}constructor(){super("nil","Nil"),this.freevars=[]}getEquations(e,t,n){let i=r.TypeVariable.getNew(),s=new r.TypeList(i),a="\\AxiomC{}\n";return a+="\\RightLabel{\\scriptsize(nil)}\n",a+="\\UnaryInfC{$"+c.gammaToTexString(e)+" \\vdash "+this.name+" : "+s.toTexString()+" $}\n",new u([new r.TypeEquation(t,s)],a)}toString(e){return"["+this.name+"]"}toTexString(e){return"{\\rm "+this.name+"}"}getRedexes(e,t){throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className)}getLeftMostRedex(e,t){throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className)}extractMacros(){return this}}t.Nil=x;class b extends d{constructor(e,t,n,r){super(e,"Macro"),this.freevars=[],this.expr=t,this.typed=n,this.type=r}static add(e,t,n){let r=t.expr;if(!/^[a-zA-Z0-9!?]+$/.test(e))throw new i.MacroError("<"+e+"> cannot be used as a name of macro. Available characters: [a-zA-Z0-9!?]");let s=n?b.map:b.mapUntyped;if(0!==r.getFV().length)throw new i.MacroError("<"+e+"> contains free variables: "+r.getFV());let a=new b(e,r,n,t.type);return s[e]=a,s[e]}static clear(e){e?b.map={}:b.mapUntyped={}}static get(e,t){let n;if(void 0===(n=t?b.map[e]:b.mapUntyped[e])){let n=n=>new b(e,o.makeAST(n,t),t,void 0);return null!==e.match(/^\d+$/)?n(o.makeChurchNum(parseInt(e))):"true"===e?n("\\xy.x"):"false"===e?n("\\xy.y"):"S"===e?n("\\fgx.fx(gx)"):"K"===e?n("\\xy.x"):"I"===e?n("\\x.x"):new b(e,void 0,t,void 0)}return new b(e,n.expr,t,n.type)}static getMap(e){return Object.assign({},e?b.map:b.mapUntyped)}substitute(e,t){return this}toString(e){return"<"+this.name+">"}equalsAlpha(e){return void 0===this.expr?this.equals(e):this.expr.equalsAlpha(e)}getEquations(e,t,n){if(void 0===this.expr)throw new i.TypeError(this+" is undefined.");return this.expr.getEquations(e,t,n)}toTexString(e){return"\\,\\overline{\\bf "+this.name+"}\\,"}getRedexes(e,t){let n=b.get(this.name,!1);return void 0===n.expr?[]:[new a.MacroRedex(n)]}getTypedRedex(e){let t=b.get(this.name,!0);return void 0===t.expr?null:new a.MacroRedex(t)}getLeftMostRedex(e,t){let n=b.get(this.name,!1);return void 0===n.expr?null:new a.MacroRedex(n)}extractMacros(){return void 0===this.expr?this:this.expr.extractMacros()}toLMNtal(){return void 0===this.expr?"fv("+this.name+")":this.expr.toLMNtal()}toSKI(){return this}getDeBrujin(e){return void 0===this.expr?new l.deBrujinFreeVar(this.name):this.expr.getDeBrujin(e)}}b.map={},b.mapUntyped={},t.Macro=b;class w extends h{constructor(e,t){super("LambdaAbstraction"),this.freevars=void 0,this.boundvar=e,this.expr=t}static parse(e,t){let n=[];for(;e.length>0;){let r=e.shift();if("."===r.name){if(0===n.length)throw new i.LambdaParseError("Bound variables are expected.");let r=o.parseSymbols(e,t);for(;n.length>0;)r=new w(n.pop(),r);return r}if(null===r.name.match(/^[A-Za-z]$/))throw new i.LambdaParseError("Unexpected token: '"+r+"'");n.push(new c(r.name))}throw new i.LambdaParseError("'.' is needed")}toString(e){let t=[this.boundvar],n=this.expr;for(;n instanceof w;)t.push(n.boundvar),n=n.expr;let r="\\"+t.join("")+"."+n.toString(!0);return e||(r="("+r+")"),r}getFV(){return void 0!==this.freevars?this.freevars:(this.freevars=[],this.freevars=c.dif(this.expr.getFV(),[this.boundvar]))}substitute(e,t){if(this.boundvar.equals(e))return this;if(c.contains(t.getFV(),this.boundvar)){let n=c.union(this.expr.getFV(),t.getFV()),r=c.getNew(n);return new w(r,this.expr.substitute(this.boundvar,r)).substitute(e,t)}return new w(this.boundvar,this.expr.substitute(e,t))}equals(e){return e instanceof w&&e.boundvar.equals(this.boundvar)&&e.expr.equals(this.expr)}equalsAlpha(e){if(!(e instanceof w))return!1;if(this.equals(e))return!0;let t=this.boundvar,n=this.expr,r=e.boundvar,i=e.expr,s=c.getNew(c.union(n.getFV(),i.getFV()));return n.substitute(t,s).equalsAlpha(i.substitute(r,s))}getEquations(e,t,n){let i=r.TypeVariable.getNew(),s=r.TypeVariable.getNew();this.boundvar.type=s;let a=this.expr.getEquations(e.concat(this.boundvar),i,!0),o=a.proofTree;return o+="\\RightLabel{\\scriptsize(abs)}\n",o+="\\UnaryInfC{$"+c.gammaToTexString(e)+" \\vdash "+this.toTexString(n)+" : "+t.toTexString()+" $}\n",new u(a.eqs.concat(new r.TypeEquation(t,new r.TypeFunc(s,i))),o)}toTexString(e){let t=[this.boundvar.toTexString(!1)],n=this.expr;for(;n instanceof w;)t.push(n.boundvar.toTexString(!1)),n=n.expr;let r="\\lambda "+t.join("")+"."+n.toTexString(!0);return e||(r="("+r+")"),r}isEtaRedex(){return this.expr instanceof y&&this.expr.right.equals(this.boundvar)&&!c.contains(this.expr.left.getFV(),this.boundvar)}getRedexes(e,t){let n=[this.boundvar],r=this.expr;for(;r instanceof w;)n.push(r.boundvar),r=r.expr;let i="",s="";t||(i="(",s=")");let o=a.Redex.makeNext(r.getRedexes(e,!0),i+"\\"+n.join("")+".",s,i+"\\lambda{"+n.join("")+"}.",s,e=>{let t=[].concat(n),r=e;for(;t.length>0;){let e=t.pop();r=new w(e,r)}return r});return void 0===e&&(console.error("etaAllowed is undefined."),e=!1),e&&this.isEtaRedex()&&o.push(new a.EtaRedex(this)),o}getTypedRedex(e){return null}getLeftMostRedex(e,t){if(void 0===e&&(console.error("etaAllowed is undefined."),e=!1),e&&this.isEtaRedex())return new a.EtaRedex(this);let n=[this.boundvar],r=this.expr;for(;r instanceof w;)n.push(r.boundvar),r=r.expr;let i="",s="";t||(i="(",s=")");let o=r.getLeftMostRedex(e,!0);return null===o?null:(o.next=(e=>{let t=[].concat(n),r=e;for(;t.length>0;){let e=t.pop();r=new w(e,r)}return r})(o.next),o.addLeft(i+"\\"+n.join("")+"."),o.addRight(s),o.addTexLeft(i+"\\lambda{"+n.join("")+"}."),o.addTexRight(s),o)}extractMacros(){return new w(this.boundvar,this.expr.extractMacros())}toLMNtal(){let e=this.expr.toLMNtal().split("fv("+this.boundvar.name+")"),t=e[0],n=[];for(let r=1;r<e.length;r++){let i=s.LambdaFriends.getNewLink();n.push(i),t+=i+e[r]}return"lambda("+function e(t){switch(t.length){case 0:return"rm";case 1:return t[0];case 2:return"cp("+t[0]+","+t[1]+")";default:return"cp("+t.shift()+","+e(t)+")"}}(n)+","+t+")"}toSKI(){if(!c.contains(this.expr.getFV(),this.boundvar))return new y(b.get("K",!1),this.expr.toSKI());if(this.boundvar.equals(this.expr))return b.get("I",!1);if(this.expr instanceof y){let e=e=>new w(this.boundvar,e).toSKI();return new y(new y(b.get("S",!1),e(this.expr.left)),e(this.expr.right))}if(this.expr instanceof w){let e=this.expr.toSKI();return new w(this.boundvar,e).toSKI()}throw new i.TranslateError("Unknown kind of expression.")}getDeBrujin(e){e.unshift(this.boundvar);let t=this.expr.getDeBrujin(e);return e.shift(),new l.deBrujinLambda(t)}}t.LambdaAbstraction=w;class y extends h{constructor(e,t){super("Application"),this.left=e,this.right=t}isBetaRedex(){return this.left instanceof w}toString(e){let t=this.left.toString(this.left instanceof y)+this.right.toString(!1);return e||(t="("+t+")"),t}getFV(){return void 0===this.freevars?this.freevars=c.union(this.left.getFV(),this.right.getFV()):this.freevars}substitute(e,t){return new y(this.left.substitute(e,t),this.right.substitute(e,t))}equals(e){return e instanceof y&&e.left.equals(this.left)&&e.right.equals(this.right)}equalsAlpha(e){return e instanceof y&&e.left.equalsAlpha(this.left)&&e.right.equalsAlpha(this.right)}getEquations(e,t,n){let i=r.TypeVariable.getNew(),s=this.left.getEquations(e,new r.TypeFunc(i,t),!1),a=this.right.getEquations(e,i,!1),o=s.proofTree+a.proofTree;return o+="\\RightLabel{\\scriptsize(app)}\n",o+="\\BinaryInfC{$"+c.gammaToTexString(e)+" \\vdash "+this.toTexString(n)+" : "+t.toTexString()+" $}\n",new u(s.eqs.concat(a.eqs),o)}toTexString(e){let t=this.left.toTexString(this.left instanceof y)+this.right.toTexString(!1);return e||(t="("+t+")"),t}getRedexes(e,t){let n=[this],r=[""],i=[""];for(;;){let e=n[n.length-1];if(r.push(e.right.toString(!1)+r[r.length-1]),i.push(e.right.toTexString(!1)+r[i.length-1]),!(e.left instanceof y))break;n.push(e.left)}let s=n[n.length-1].left.getRedexes(e,!1);for(;n.length>0;){let t=n.pop(),o=a.Redex.makeNext(s,"",t.right.toString(!1),"",t.right.toTexString(!1),e=>new y(e,t.right)),l=t.left.toString(t.left instanceof y),u=a.Redex.makeNext(t.right.getRedexes(e,!1),l,"",t.left.toTexString(!1),"",e=>new y(t.left,e));s=o.concat(u),r.pop(),i.pop(),t.isBetaRedex()&&s.push(new a.BetaRedex(t))}return t||(s=a.Redex.makeNext(s,"(",")","(",")",e=>e)),s}getTypedRedex(e){let t=e?"":"(",n=e?"":")";if(this.left instanceof w)return new a.TypedRedex(this,this.left.expr.substitute(this.left.boundvar,this.right),"app2");if(this.left instanceof y&&this.left.left instanceof m&&this.left.right instanceof p){let e=this.left.left,s=this.left.right,o=this.right;if(o instanceof p){if(e.type.left.equals(s.type)&&e.type.right instanceof r.TypeFunc&&e.type.right.left.equals(o.type))return new a.TypedRedex(this,e.value(s,o),"app5");throw new i.ReductionError(e.type+" cannot handle "+s.type+" and "+o.type+" as arguments")}{let r=o.getTypedRedex(!1);return null===r?null:(r.next=new y(new y(e,s),r.next),r.addLeft(t+e.toString(!1)+s.toString(!1)),r.addRight(n),r.addTexLeft(t+e.toTexString(!1)+s.toTexString(!1)),r.addTexRight(n),r)}}if(this.left instanceof m){let e=this.right.getTypedRedex(!1);return null===e?null:(e.next=new y(this.left,e.next),e.addLeft(t+this.left.toString(!1)),e.addRight(n),e.addTexLeft(t+this.left.toTexString(!1)),e.addTexRight(n),e)}{let e=this.right.getTypedRedex(!1);return null===e?null:(e.next=new y(this.left,e.next),e.addLeft(t),e.addRight(n+this.right.toString(!1)),e.addTexLeft(t),e.addTexRight(n+this.right.toTexString(!1)),e)}}getLeftMostRedex(e,t){let n=[this],r=[""],i=[""];for(;;){let e=n[n.length-1];if(r.push(e.right.toString(!1)+r[r.length-1]),i.push(e.right.toTexString(!1)+r[i.length-1]),!(e.left instanceof y))break;n.push(e.left)}let s=n[n.length-1].left.getLeftMostRedex(e,!1);for(;n.length>0;){let t=n.pop();if(t.isBetaRedex())s=new a.BetaRedex(t);else if(null===s){if(null!==(s=t.right.getLeftMostRedex(e,!1))){let e=t.left.toString(!0);s.next=new y(t.left,s.next),s.addLeft(e),s.addRight(""),s.addTexLeft(t.left.toTexString(!1)),s.addTexRight("")}}else s.next=new y(s.next,t.right),s.addLeft(""),s.addRight(t.right.toString(!1)),s.addTexLeft(""),s.addTexRight(t.right.toTexString(!1));r.pop(),i.pop()}return null===s?null:(t||(s.addLeft("("),s.addRight(")"),s.addTexLeft("("),s.addTexRight(")")),s)}extractMacros(){return new y(this.left.extractMacros(),this.right.extractMacros())}toLMNtal(){return"apply("+this.left.toLMNtal()+","+this.right.toLMNtal()+")"}toSKI(){return new y(this.left.toSKI(),this.right.toSKI())}getDeBrujin(e){return new l.deBrujinApplication(this.left.getDeBrujin(e),this.right.getDeBrujin(e))}}t.Application=y;class T extends h{constructor(e,t){super("List"),this.head=e,this.tail=t}toString(e){let t=this.head.toString(!1)+"::"+this.tail.toString(!0);return e||(t="("+t+")"),t}getFV(){return void 0===this.freevars?this.freevars=c.union(this.head.getFV(),this.tail.getFV()):this.freevars}substitute(e,t){return new T(this.head.substitute(e,t),this.tail.substitute(e,t))}equals(e){return e instanceof T&&e.head.equals(this.head)&&e.tail.equals(this.tail)}equalsAlpha(e){return e instanceof T&&e.head.equalsAlpha(this.head)&&e.tail.equalsAlpha(this.tail)}getEquations(e,t,n){let i=r.TypeVariable.getNew(),s=new r.TypeList(i),a=this.head.getEquations(e,i,!1),o=this.tail.getEquations(e,s,!1),l=a.proofTree+o.proofTree;return l+="\\RightLabel{\\scriptsize(list)}\n",l+="\\BinaryInfC{$"+c.gammaToTexString(e)+" \\vdash "+this.toTexString(n)+" : "+s.toTexString()+" $}\n",new u(a.eqs.concat(o.eqs,new r.TypeEquation(s,t)),l)}toTexString(e){let t=this.head.toTexString(!1)+"::"+this.tail.toTexString(!0);return e||(t="("+t+")"),t}getRedexes(e,t){throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className)}getLeftMostRedex(e,t){throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className)}getTypedRedex(e){return null}extractMacros(){return new T(this.head.extractMacros(),this.tail.extractMacros())}}t.List=T;class v extends h{constructor(e,t,n){super("If"),this.state=e,this.ifTrue=t,this.ifFalse=n}getFV(){return this.freevars=c.union(this.state.getFV(),this.ifTrue.getFV(),this.ifFalse.getFV())}toString(e){let t="[if]"+this.state.toString(!0)+"[then]"+this.ifTrue.toString(!0)+"[else]"+this.ifFalse.toString(!0);return e||(t="("+t+")"),t}substitute(e,t){return new v(this.state.substitute(e,t),this.ifTrue.substitute(e,t),this.ifFalse.substitute(e,t))}equals(e){return e instanceof v&&e.state.equals(this.state)&&e.ifTrue.equals(this.ifTrue)&&e.ifFalse.equals(this.ifFalse)}equalsAlpha(e){return e instanceof v&&e.state.equalsAlpha(this.state)&&e.ifTrue.equalsAlpha(this.ifTrue)&&e.ifFalse.equalsAlpha(this.ifFalse)}getEquations(e,t,n){let i=this.state.getEquations(e,new r.TypeBool,!0),s=this.ifTrue.getEquations(e,t,!0),a=this.ifFalse.getEquations(e,t,!0),o=i.proofTree+s.proofTree+a.proofTree;return o+="\\RightLabel{\\scriptsize(if)}\n",o+="\\TrinaryInfC{$"+c.gammaToTexString(e)+" \\vdash "+this.toTexString(n)+" : "+t.toTexString()+" $}\n",new u(i.eqs.concat(s.eqs,a.eqs),o)}toTexString(e){let t="{\\bf if}~"+this.state.toTexString(!0)+"~{\\bf then}~"+this.ifTrue.toTexString(!0)+"~{\\bf else}~"+this.ifFalse.toTexString(!0);return e||(t="("+t+")"),t}getRedexes(e,t){throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className)}getLeftMostRedex(e,t){throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className)}getTypedRedex(e){if(this.state instanceof g)return this.state.value?new a.TypedRedex(this,this.ifTrue,"if2"):new a.TypedRedex(this,this.ifFalse,"if3");{let e=this.state.getTypedRedex(!1);return null===e?null:(e.next=new v(e.next,this.ifTrue,this.ifFalse),e.addLeft("([if]"),e.addRight("[then]"+this.ifTrue.toString(!0)+"[else]"+this.ifFalse.toString(!0)+")"),e.addTexLeft("({\\bf if}~"),e.addTexRight("~{\\bf then}~"+this.ifTrue.toTexString(!0)+"~{\\bf else}~"+this.ifFalse.toTexString(!0)+")"),e)}}static parse(e,t){let n=[],r=0,s=0,a=0;for(;;){if(0==e.length)throw new i.LambdaParseError("Illegal If statement");let t=e.shift();switch(t.name){case"if":r++;break;case"then":s++;break;case"else":a++}if(r===a&&s===r+1)break;n.push(t)}let l=o.parseSymbols(n,t),u=[];for(r=0,s=0,a=0;;){if(0==e.length)throw new i.LambdaParseError("Illegal If statement");let t=e.shift();switch(t.name){case"if":r++;break;case"then":s++;break;case"else":a++}if(r===s&&a===r+1)break;u.push(t)}let h=o.parseSymbols(u,t),d=o.parseSymbols(e,t);return new v(l,h,d)}extractMacros(){return new v(this.state.extractMacros(),this.ifTrue.extractMacros(),this.ifFalse.extractMacros())}}t.If=v;class S extends h{constructor(e,t,n){super("Let"),this.boundvar=e,this.left=t,this.right=n}getFV(){if(void 0!==this.freevars)return this.freevars;let e=[];for(let t of this.right.getFV())t.equals(this.boundvar)||e.push(t);return this.freevars=c.union(e,this.left.getFV())}toString(e){let t="[let]"+this.boundvar.toString(!0)+"="+this.left.toString(!0)+"[in]"+this.right.toString(!0);return e||(t="("+t+")"),t}substitute(e,t){let n=this.left.substitute(e,t);if(this.boundvar.equals(e))return new S(this.boundvar,n,this.right);if(c.contains(t.getFV(),this.boundvar)){let r=c.union(this.right.getFV(),t.getFV()),i=c.getNew(r);return i.equals(e)?new S(i,n,this.right.substitute(this.boundvar,i)):new S(i,n,this.right.substitute(this.boundvar,i).substitute(e,t))}return new S(this.boundvar,n,this.right.substitute(e,t))}equals(e){return e instanceof S&&e.boundvar.equals(this.boundvar)&&e.left.equals(this.left)&&e.right.equals(this.right)}equalsAlpha(e){if(!(e instanceof S))return!1;if(this.equals(e))return!0;let t=this.boundvar,n=this.right,r=e.boundvar,i=e.right;return!c.contains(n.getFV(),r)&&i.equalsAlpha(n.substitute(t,r))}getEquations(e,t,n){let i=r.TypeVariable.getNew();this.boundvar.type=i;let s=this.left.getEquations(e,i,!0),a=this.right.getEquations(e.concat(this.boundvar),t,!0),o=s.proofTree+a.proofTree;return o+="\\RightLabel{\\scriptsize(let)}\n",o+="\\TrinaryInfC{$"+c.gammaToTexString(e)+" \\vdash "+this.toTexString(n)+" : "+t.toTexString()+" $}\n",new u(s.eqs.concat(a.eqs),o)}toTexString(e){let t="{\\bf let}~"+this.boundvar.toTexString(!1)+" = "+this.left.toTexString(!0)+"~{\\bf in}~"+this.right.toTexString(!0);return e||(t="("+t+")"),t}getRedexes(e,t){throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className)}getLeftMostRedex(e,t){throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className)}getTypedRedex(e){return new a.TypedRedex(this,this.right.substitute(this.boundvar,this.left),"let")}static parse(e,t){let n=e.shift();if(null===n.name.match(/^[A-Za-z]$/))throw new i.LambdaParseError("Unexpected token: '"+n+"'");let r=new c(n.name);if("="!==e.shift().name)throw new i.LambdaParseError("'=' is expected");let s=[],a=1;for(;;){if(0==e.length)throw new i.LambdaParseError("Illegal Let statement");let t=e.shift();if("let"===t.name?a++:"in"===t.name&&a--,0==a)break;s.push(t)}let l=o.parseSymbols(s,t),u=o.parseSymbols(e,t);return new S(r,l,u)}extractMacros(){return new S(this.boundvar,this.left.extractMacros(),this.right.extractMacros())}}t.Let=S;class E extends h{constructor(e,t,n,r,i){super("Case"),this.state=e,this.ifNil=t,this.head=n,this.tail=r,this.ifElse=i}getFV(){return void 0!==this.freevars?this.freevars:c.union(this.state.getFV(),this.ifNil.getFV(),c.dif(this.ifElse.getFV(),[this.head,this.tail]))}toString(e){let t="[case]"+this.state.toString(!0)+"[of][nil]->"+this.ifNil.toString(!0)+"|"+this.head.toString(!0)+"::"+this.tail.toString(!0)+"->"+this.ifElse.toString(!0);return e||(t="("+t+")"),t}substitute(e,t){let n=this.state.substitute(e,t),r=this.ifNil.substitute(e,t);if(this.head.equals(e)||this.tail.equals(e))return new E(n,r,this.head,this.tail,this.ifElse);if(c.contains(t.getFV(),this.head)||c.contains(t.getFV(),this.tail)){let i=this.head,s=this.tail,a=this.ifElse;if(c.contains(t.getFV(),i)){let n=c.union(this.ifElse.getFV(),t.getFV()),r=c.getNew(n);a=r.equals(e)?a.substitute(i,r):a.substitute(i,r).substitute(e,t),i=r}if(c.contains(t.getFV(),s)){let n=c.union(this.ifElse.getFV(),t.getFV()),r=c.getNew(n);a=r.equals(e)?a.substitute(s,r):a.substitute(s,r).substitute(e,t),s=r}return new E(n,r,i,s,a)}return new E(n,r,this.head,this.tail,this.ifElse.substitute(e,t))}equals(e){return e instanceof E&&e.state.equals(this.state)&&e.ifNil.equals(this.ifNil)&&e.head.equals(this.head)&&e.tail.equals(this.tail)&&e.ifElse.equals(this.ifElse)}equalsAlpha(e){return e instanceof E&&e.state.equalsAlpha(this.state)&&e.ifNil.equalsAlpha(this.ifNil)&&e.head.equalsAlpha(this.head)&&e.tail.equalsAlpha(this.tail)&&e.ifElse.equalsAlpha(this.ifElse)}getEquations(e,t,n){let i=r.TypeVariable.getNew(),s=new r.TypeList(i);this.head.type=i,this.tail.type=s;let a=this.state.getEquations(e,s,!0),o=this.ifNil.getEquations(e,t,!0),l=this.ifElse.getEquations(e.concat(this.head,this.tail),t,!0),h=a.proofTree+o.proofTree+l.proofTree;return h+="\\RightLabel{\\scriptsize(case)}\n",h+="\\TrinaryInfC{$"+c.gammaToTexString(e)+" \\vdash "+this.toTexString(n)+" : "+t.toTexString()+" $}\n",new u(a.eqs.concat(o.eqs,l.eqs),h)}toTexString(e){let t="{\\bf case} "+this.state.toTexString(!0)+" {\\bf of} {\\rm nil} \\Rightarrow "+this.ifNil.toTexString(!0)+" | "+this.head.toTexString(!0)+"::"+this.tail.toTexString(!0)+" \\Rightarrow "+this.ifElse.toTexString(!0);return e||(t="("+t+")"),t}getRedexes(e,t){throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className)}getLeftMostRedex(e,t){throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className)}getTypedRedex(e){if(this.state instanceof x)return new a.TypedRedex(this,this.ifNil,"case2");if(this.state instanceof T)return new a.TypedRedex(this,this.ifElse.substitute(this.head,this.state.head).substitute(this.tail,this.state.tail),"case3");{let e=this.state.getTypedRedex(!0);return null===e?null:(e.next=new E(e.next,this.ifNil,this.head,this.tail,this.ifElse),e.addLeft("([case]"),e.addRight("[of][nil]->"+this.ifNil+" | "+this.head+"::"+this.tail+"->"+this.ifElse+")"),e.addTexLeft("({\\bf case} "),e.addTexRight(" {\\bf of} {\\rm nil} \\Rightarrow "+this.ifNil.toTexString(!0)+" | "+this.head.toTexString(!0)+"::"+this.tail.toTexString(!0)+" \\Rightarrow "+this.ifElse.toTexString(!0)+")"),e)}}static parse(e,t){let n=[],r=1;for(;;){if(0==e.length)throw new i.LambdaParseError("Illegal Case statement");let t=e.shift();if("case"===t.name?r++:"of"===t.name&&r--,0==r)break;n.push(t)}let s=o.parseSymbols(n,t),a=e.shift();if("nil"!==a.name)throw new i.LambdaParseError("Unexpected token: '"+a+"'");if("-"!==(a=e.shift()).name)throw new i.LambdaParseError("Unexpected token: '"+a+"'");if(">"!==(a=e.shift()).name)throw new i.LambdaParseError("Unexpected token: '"+a+"'");let l=[];for(r=1;;){if(0==e.length)throw new i.LambdaParseError("Too many [case]");let t=e.shift();if("case"===t.name?r++:"|"===t.name&&r--,0==r)break;l.push(t)}let u=o.parseSymbols(l,t),h=new c(e.shift().name);if(null===h.name.match(/^[A-Za-z]$/))throw new i.LambdaParseError("Unexpected token: '"+h.name+"'");if(":"!==(a=e.shift()).name)throw new i.LambdaParseError("Unexpected token: '"+a+"'");if(":"!==(a=e.shift()).name)throw new i.LambdaParseError("Unexpected token: '"+a+"'");let d=new c(e.shift().name);if(null===d.name.match(/^[A-Za-z]$/))throw new i.LambdaParseError("Unexpected token: '"+d.name+"'");if("-"!==(a=e.shift()).name)throw new i.LambdaParseError("Unexpected token: '"+a+"'");if(">"!==(a=e.shift()).name)throw new i.LambdaParseError("Unexpected token: '"+a+"'");let p=o.parseSymbols(e,t);return new E(s,u,h,d,p)}extractMacros(){return new E(this.state.extractMacros(),this.ifNil.extractMacros(),this.head,this.tail,this.ifElse.extractMacros())}}t.Case=E;class L extends h{constructor(e,t){super("Fix"),this.boundvar=e,this.expr=t}getFV(){if(void 0!==this.freevars)return this.freevars;let e=[];for(let t of this.expr.getFV())t.equals(this.boundvar)||e.push(t);return this.freevars=e}toString(e){let t="[fix]"+this.boundvar.toString(!1)+"."+this.expr.toString(!0);return e||(t="("+t+")"),t}substitute(e,t){if(this.boundvar.equals(e))return this;if(c.contains(t.getFV(),this.boundvar)){let n=c.union(this.expr.getFV(),t.getFV()),r=c.getNew(n);return new L(r,this.expr.substitute(this.boundvar,r)).substitute(e,t)}return new L(this.boundvar,this.expr.substitute(e,t))}equals(e){return e instanceof L&&e.boundvar.equals(this.boundvar)&&e.expr.equals(this.expr)}equalsAlpha(e){if(!(e instanceof L))return!1;if(this.equals(e))return!0;let t=this.boundvar,n=this.expr,r=e.boundvar,i=e.expr;return c.contains(n.getFV(),r)?i.equalsAlpha(n):i.equalsAlpha(n.substitute(t,r))}getEquations(e,t,n){this.boundvar.type=t;let r=this.expr.getEquations(e.concat(this.boundvar),t,!0),i=r.proofTree;return i+="\\RightLabel{\\scriptsize(fix)}\n",i+="\\UnaryInfC{$"+c.gammaToTexString(e)+" \\vdash "+this.toTexString(n)+" : "+t.toTexString()+" $}\n",new u(r.eqs,i)}toTexString(e){let t="{\\bf fix}~"+this.boundvar.toTexString(!0)+"."+this.expr.toTexString(!0);return e||(t="("+t+")"),t}getRedexes(e,t){throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className)}getLeftMostRedex(e,t){throw new i.ReductionError("Untyped Reduction cannot handle typeof "+this.className)}getTypedRedex(e){return new a.TypedRedex(this,this.expr.substitute(this.boundvar,new L(new c(this.boundvar.name),this.expr)),"fix")}static parse(e,t){let n=e.shift();if(null===n.name.match(/^[A-Za-z]$/))throw new i.LambdaParseError("Unexpected token: '"+n+"'");let r=new c(n.name);if("."!==e.shift().name)throw new i.LambdaParseError("'.' is expected");let s=o.parseSymbols(e,t);return new L(r,s)}extractMacros(){return new L(this.boundvar,this.expr.extractMacros())}}t.Fix=L},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(1);function s(e,t){let n=null;for(;e.length>0;){let a=e.shift();if(a instanceof i.Const||a instanceof i.Nil||a instanceof i.Macro)n=null===n?a:new i.Application(n,a);else switch(a.name){case"\\":case"¥":case"λ":return null===n?i.LambdaAbstraction.parse(e,t):new i.Application(n,i.LambdaAbstraction.parse(e,t));case"(":{let a=[],o=1;for(;;){if(0===e.length)throw new r.LambdaParseError("Too many LPAREN '('");let t=e.shift();if("("===t.name?o++:")"===t.name&&o--,0===o)break;a.push(t)}let l=s(a,t);n=null===n?l:new i.Application(n,l);break}default:if(t)switch(a.name){case"if":return i.If.parse(e,t);case"let":return i.Let.parse(e,t);case"case":return i.Case.parse(e,t);case"fix":return i.Fix.parse(e,t);case":":{let a=e.shift();if(":"!==a.name)throw new r.LambdaParseError("Unexpected token: '"+a+"'");return new i.List(n,s(e,t))}}if(null===a.name.match(/^[A-Za-z]$/))throw new r.LambdaParseError("Unexpected token: '"+a+"'");n=null===n?new i.Variable(a.name):new i.Application(n,new i.Variable(a.name))}}if(null===n)throw new r.LambdaParseError("No contents in Expression");return n}t.parseSymbols=s,t.makeAST=function(e,t){return s(function(e,t){let n=e.split(""),s=[];for(;n.length>0;){let e=n.shift().trim();if(""===e);else if("<"===e){let a="";for(;;){if(0==n.length)throw new r.LambdaParseError("Too many LANGLE '<'");if(">"===(e=n.shift()))break;a+=e}s.push(i.Macro.get(a,t))}else if(t&&"["===e){let t="";for(;;){if(0==n.length)throw new r.LambdaParseError("Too many LBRACKET '['");if("]"===(e=n.shift()))break;t+=e}let a=null;switch(t){case"nil":a=new i.Nil;break;case"false":case"true":a=new i.ConstBool("true"===t);break;case"if":case"then":case"else":case"let":case"in":case"case":case"of":case"fix":a=new i.Symbol(t);break;default:a=null!==t.match(/^\d+$|^-\d+$/)?new i.ConstInt(parseInt(t)):new i.ConstOp(t)}if(null===a)throw new r.LambdaParseError("Unknown Const: ["+t+"]");s.push(a)}else s.push(new i.Symbol(e))}return s}(e,t),t)},t.parseLMNtal=function(e){return function e(n,s,a){let o=(n=n.trim()).match(/^.+?(?=\()/);if(null===o){let e=a[n];if(void 0===e)throw new r.LambdaParseError("Malformed LMNtal Lambda Term. Unknown Token: "+n);return new i.Variable(e)}let l=o[0].trim(),u=t(n.match(/\(.+$/)[0]);switch(l){case"lambda":{if(2!==u.length)throw new r.LambdaParseError("Malformed LMNtal Lambda Term. lambda(X,A) should have 2 args.");let n=i.Variable.getNew(s),o=function e(n){let i=(n=n.trim()).match(/^.+?(?=\()/);if(null===i)return"rm"===n?[]:[n];let s=i[0].trim(),a=t(n.match(/\(.+$/)[0]);if("rm"===s){if(0!==a.length)throw new r.LambdaParseError("Malformed LMNtal Lambda Term. rm() should have 0 args.");return[]}if("cp"===s){if(2!==a.length)throw new r.LambdaParseError("Malformed LMNtal Lambda Term. cp(A,B) should have 2 args.");return e(a[0].trim()).concat(e(a[1].trim()))}throw new r.LambdaParseError("Malformed LMNtal Lambda Term. Unexpected atom name: "+s)}(u[0]);for(let e of o)a[e]=n.name;return new i.LambdaAbstraction(n,e(u[1],s.concat(n),Object.assign({},a)))}case"apply":if(2!==u.length)throw new r.LambdaParseError("Malformed LMNtal Lambda Term. apply(A,B) should have 2 args.");return new i.Application(e(u[0],[].concat(s),Object.assign({},a)),e(u[1],[].concat(s),Object.assign({},a)));case"fv":if(1!==u.length)throw new r.LambdaParseError("Malformed LMNtal Lambda Term. fv(X) should have 1 arg.");return 1===u[0].length&&u[0].match(/[a-z]/)?new i.Variable(u[0]):i.Macro.get(u[0],!1);default:throw new r.LambdaParseError("Malformed LMNtal Lambda Term. Unexpected atom name: "+l)}}(e,[],{});function t(e){if("("!==(e=e.trim())[0]||")"!==e[e.length-1])throw new r.LambdaParseError("Malformed LMNtal Lambda Term. Invalid Parentheses.");let t=0,n="",i=[];for(let r=1;r<e.length-1;r++){let s=e[r];"("===s?t++:")"===s&&t--,0===t&&","===s?(i.push(n),n=""):n+=s}if(0!==t)throw new r.LambdaParseError("Malformed LMNtal Lambda Term. Invalid Parentheses.");if(i.push(n),1===i.length){let e=i[0].trim();return""===e?[]:[e]}let s=[];for(let e of i)s.push(e.trim());return s}},t.makeChurchNum=function(e){let t=0===e?"z":"sz";for(let n=1;n<e;n++)t="s("+t+")";return"\\sz."+t},t.makeTerms=function(e){return function e(t,n){let r=[].concat(t);if(0===n)return r;let s=e(t,n-1);for(let e=0;e<s.length;e++)for(let t=0;t<s.length;t++)r.push(new i.Application(s[e],s[t]));let a=i.Variable.getNew(t),o=e(t.concat(a),n-1);for(let e of o)r.push(new i.LambdaAbstraction(a,e));return r}([],e)},t.htmlEscape=function(e){return e.replace(/[&'`"<>]/g,function(e){return{"&":"&amp;","'":"&#x27;","`":"&#x60;",'"':"&quot;","<":"&lt;",">":"&gt;"}[e]})},t.putParens=function(e,t){return t?e:"("+e+")"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),i=n(4),s=n(8),a=n(5),o=n(2),l=n(6);class u{constructor(e,t,n,i){let a=e.split("#")[0].trim(),l=[];for(;;){let e=a.match(/^[^[]+?\s*=\s*/);if(null===e)break;let t=e[0];(e=a.split(t)).shift(),a=e.join(t),l.push(t.split(/\s*=\s*$/)[0])}this.expr=o.makeAST(a,t),this.original=this.expr,this.type=this.getType(t);for(let e of l)r.Macro.add(e,this,t);this.typed=t,this.etaAllowed=n,this.allowMultipleEdges=i,this.processTex="\\begin{eqnarray*}\n&& ",this.curStep=0,this.root=s.ReductionNode.makeRoot(this.expr,this.typed,this.etaAllowed,this.allowMultipleEdges),this.curNodes=[this.root],this.nextRedexes=void 0}getRedexes(){if(this.nextRedexes)return this.nextRedexes;if(this.typed){let e=this.expr.getTypedRedex(!0);return this.nextRedexes=e?[e]:[]}return this.nextRedexes=this.expr.getRedexes(this.etaAllowed,!0).sort(a.Redex.compare)}getLeftMostRedex(){return this.typed?this.expr.getTypedRedex(!0):this.nextLeftMostRedex?this.nextLeftMostRedex:this.nextLeftMostRedex=this.expr.getLeftMostRedex(this.etaAllowed,!0)}reduction(e){if(void 0===e&&!(e=this.getLeftMostRedex()))return null;let t;if(this.expr=e.next,this.nextRedexes=void 0,this.nextLeftMostRedex=void 0,this.processTex+=e.toTexString(),"macro"===e.type?(this.processTex+=" \\\\\n&\\equiv& ",t="-: (macro) = "+this.expr.toString(!0)):(this.processTex+=" \\\\\n&\\longrightarrow_{"+e.getTexRule()+"}& ",t=++this.curStep+": ("+e.rule+") --\x3e "+this.expr.toString(!0)),!this.hasNext()){t+="    (normal form)\n";let e=this.parseChurchNum();null!==e&&(t+="  = "+e+" (as nat)\n");let n=this.parseChurchBool();null!==n&&(t+="  = "+n+" (as bool)\n"),t=t.slice(0,-1)}return t}deepen(e){if(0===this.curNodes.length)return null;let t=this.curNodes.shift();if(void 0!==e&&t.depth>=e)return this.curNodes.push(t),null;let n=t.visit();for(let e of n.nodes)this.curNodes.push(e);return n}hasNext(){return null!==this.getLeftMostRedex()}hasNodes(){return this.curNodes.length>0}getProofTree(){return"\\begin{prooftree}\n"+this.proofTree+"\\end{prooftree}"}getProcessTex(){return this.processTex+this.expr.toTexString(!0)+(this.hasNext()?"":"\\not\\longrightarrow")+"\n\\end{eqnarray*}"}getType(e){if(!e)return new i.TypeUntyped;i.TypeVariable.maxId=void 0;let t=i.TypeVariable.getNew(),n=this.expr.getEquations([],t,!0),r=n.eqs;this.proofTree=n.proofTree;let s=i.TypeEquation.get(t,i.TypeEquation.solve(r)),a=s.getVariables(),o=[];for(let e of a)i.TypeVariable.contains(o,e)||o.push(e);let l=0;for(let e of o)s.replace(e,i.TypeVariable.getAlphabet(l)),l++;return s}static parseMacroDef(e,t){let n=e.split("#")[0].trim(),i=[];for(;;){let e=n.match(/^[^[]+?\s*=\s*/);if(null===e)break;let t=e[0];(e=n.split(t)).shift(),n=e.join(t),i.push(t.split(/\s*=\s*$/)[0])}if(0===i.length)return null;let s=new u(n,t,!1,!1);for(let e of i)r.Macro.add(e,s,t);return{names:i,expr:s.expr.toString(!0),type:s.type.toString()}}static fileInput(e,t){let n=e.split("\n"),r=[],i=[];for(let e of n)try{let n=u.parseMacroDef(e,t);null!==n&&i.push(n)}catch(e){r.push(e.toString())}return{defs:i,errs:r}}static getMacroList(e){let t="",n=r.Macro.getMap(e);for(let e in n){let r=n[e];t+="<"+r.name+"> is defined as "+r.expr.toString(!0)+" : "+r.type+"\n"}return t}static getMacroListAsObject(e){return r.Macro.getMap(e)}static clearMacro(e){return r.Macro.clear(e)}static graph2LF(e,t){return s.GraphNode.search(s.GraphNode.parse(e),t)}static lmntal2LF(e){return new u(o.parseLMNtal(e).toString(!0),!1,!1,!1)}static deBrujin2LF(e){return new u(l.deBrujinExpression.parse(e).toLambda().toString(!0),!1,!1,!1)}toLMNtal(){return u.nextLinkID=0,this.typed?null:this.original.toLMNtal()}toSKI(){return this.typed?null:this.original.toSKI().toString(!0)}toDeBrujin(){return this.typed?null:this.original.toDeBrujin().toString()}toString(){let e=this.expr.toString(!0)+" : "+this.type;if(!this.hasNext()){e+="    (normal form)\n";let t=this.parseChurchNum();null!==t&&(e+="  = "+t+" (as nat)\n");let n=this.parseChurchBool();null!==n&&(e+="  = "+n+" (as bool)\n"),e=e.slice(0,e.length-1)}return e}getOriginalString(){return this.original.toString(!0)+" : "+this.type}parseChurchNum(){return this.expr.parseChurchNum()}parseChurchBool(){return this.expr.parseChurchBool()}static getNewLink(){return"R"+u.nextLinkID++}}t.LambdaFriends=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);class i{constructor(e){this.className=e}}t.Type=i;class s{constructor(e,t){this.left=e,this.right=t}transform(e,t){if(this.left instanceof a&&this.right instanceof a)return this.left.match(this.right);if(this.left.equals(this.right))return[];if(!(this.left instanceof d))return[new s(this.right,this.left)];if(this.right.contains(this.left))throw new r.TypeError("Illegal type ("+this.right+" contains "+this.left+". Self-application?)");for(var n of e)n.replace(this.left,this.right);for(var n of t)n.replace(this.left,this.right);return[this]}static isEqual(e,t){if(e.length!==t.length)return!1;for(var n of e)if(!s.contains(n,t))return!1;return!0}static contains(e,t){for(var n of t)if(e.equals(n))return!0;return!1}equals(e){return e.left.equals(this.left)&&e.right.equals(this.right)}static get(e,t){for(var n of t)if(n.left.equals(e))return n.right;throw new r.TypeError("Undefined TypeVariable: "+e)}toString(){return this.left+" = "+this.right}replace(e,t){this.left.equals(e)?this.left=t:this.left.replace(e,t),this.right.equals(e)?this.right=t:this.right.replace(e,t)}static solve(e){for(;;){for(var t=[].concat(e),n=[];e.length>0;){var r=e.shift().transform(e,n);n=n.concat(r)}if(e=[].concat(n),s.isEqual(t,n))break}return e}}t.TypeEquation=s;class a extends i{}t.TypeConstructor=a;class o extends a{constructor(){super("TypeInt")}toString(){return"int"}toTexString(){return"{\\rm int}"}equals(e){return e instanceof o}match(e){if(e instanceof o)return[];throw new r.TypeError(this+" and "+e+" are not compatible.")}contains(e){return!1}replace(e,t){}getVariables(){return[]}}t.TypeInt=o;class l extends a{constructor(){super("TypeBool")}toString(){return"bool"}toTexString(){return"{\\rm bool}"}equals(e){return e instanceof l}match(e){if(e instanceof l)return[];throw new r.TypeError(this+" and "+e+" are not compatible.")}contains(e){return!1}replace(e,t){}getVariables(){return[]}}t.TypeBool=l;class u extends a{constructor(e){super("TypeList"),this.content=e}toString(){return"list("+this.content+")"}toTexString(){return"{\\rm list}("+this.content.toTexString()+")"}equals(e){return e instanceof u&&this.content.equals(e.content)}match(e){if(e instanceof u)return[new s(this.content,e.content)];throw new r.TypeError(this+" and "+e+" are not compatible.")}contains(e){return this.content.contains(e)}replace(e,t){this.content.equals(e)?this.content=t:this.content.replace(e,t)}getVariables(){return this.content.getVariables()}}t.TypeList=u;class h extends a{constructor(e,t){super("TypeFunc"),this.left=e,this.right=t}toString(){return(this.left instanceof h?"("+this.left+")":this.left.toString())+" -> "+this.right}toTexString(){return(this.left instanceof h?"("+this.left.toTexString()+")":this.left.toTexString())+" \\rightarrow "+this.right.toTexString()}equals(e){return e instanceof h&&(e.left.equals(this.left)&&e.right.equals(this.right))}match(e){if(e instanceof h)return[new s(this.left,e.left),new s(this.right,e.right)];throw new r.TypeError(this+" and "+e+" are not compatible.")}contains(e){return this.left.contains(e)||this.right.contains(e)}replace(e,t){this.left.equals(e)?this.left=t:this.left.replace(e,t),this.right.equals(e)?this.right=t:this.right.replace(e,t)}getVariables(){return this.left.getVariables().concat(this.right.getVariables())}}t.TypeFunc=h;class d extends i{constructor(e){super("TypeVariable"),this.id=e}toString(){return this.id<0?"'"+d.alphabet[-this.id-1]:"'t"+this.id}toTexString(){return this.id<0?d.texAlphabet[-this.id-1]:"\\tau_{"+this.id+"}"}equals(e){return e instanceof d&&this.id===e.id}static getNew(){return void 0===d.maxId?(d.maxId=0,new d(0)):(d.maxId++,new d(d.maxId))}contains(e){return this.equals(e)}replace(e,t){}getVariables(){return[this]}static getAlphabet(e){return new d(-e-1)}static contains(e,t){for(var n of e)if(n.equals(t))return!0;return!1}}d.alphabet="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),d.texAlphabet=["\\alpha","\\beta","\\gamma","\\delta","\\varepsilon","\\zeta","\\eta","\\theta","\\iota","\\kappa","\\mu","\\nu","\\xi","\\pi","\\rho","\\sigma","\\upsilon","\\phi","\\chi","\\psi","\\omega","\\Gamma","\\Delta","\\Theta","\\Xi","\\Pi","\\Sigma","\\Phi","\\Psi","\\Omega"].concat(d.alphabet),t.TypeVariable=d;class c extends i{constructor(){super("TypeUntyped")}toString(){return"Untyped"}toTexString(){return"{\\rm Untyped}"}equals(e){return e instanceof c}contains(e){return!1}replace(e,t){}getVariables(){return[]}}t.TypeUntyped=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),i=n(2);class s{constructor(e){this.left="",this.right="",this.texLeft="",this.texRight="",this.type=e}addLeft(e){this.left=e+this.left}addRight(e){this.right+=e}addTexLeft(e){this.texLeft=e+this.texLeft}addTexRight(e){this.texRight+=e}static makeNext(e,t,n,r,i,s){let a=[].concat(e);for(let e of a)e.next=s(e.next),e.addLeft(t),e.addRight(n),e.addTexLeft(r),e.addTexRight(i);return a}getName(){return this.type}getPos(){return this.left.length}static compare(e,t){let n=e.getPos(),r=t.getPos();if(n===r){const n=e=>e instanceof a?0:e instanceof o?1:e instanceof l?2:e instanceof u?3:void 0;return n(e)-n(t)}return n-r}}t.Redex=s;class a extends s{constructor(e){super("beta"),this.content=e,this.la=e.left,this.next=this.la.expr.substitute(this.la.boundvar,e.right),this.arg=e.right,this.rule="beta"}toString(){let e=[],t=this.la.expr;for(;t instanceof r.LambdaAbstraction;)e.push(t.boundvar.toString(!1)),t=t.expr;let n=e.join("")+"."+t.toString(!0);return this.left+"(\\["+this.la.boundvar.toString(!1)+"]"+n+")["+this.arg.toString(!1)+"]"+this.right}toTexString(){let e=[],t=this.la.expr;for(;t instanceof r.LambdaAbstraction;)e.push(t.boundvar.toTexString(!1)),t=t.expr;let n=e.join("")+"."+t.toTexString(!0);return this.texLeft+"(\\strut \\lambda{\\underline{"+this.la.boundvar.toTexString(!1)+"}}"+n+")\\underline{\\strut "+this.arg.toTexString(!1)+"}"+this.texRight}toHTMLString(){let e=[],t=this.la.expr;for(;t instanceof r.LambdaAbstraction;)e.push(t.boundvar.toString(!1)),t=t.expr;let n=e.join("")+"."+t.toString(!0);return i.htmlEscape(this.left)+'(\\<span class="lf-beta lf-boundvar">'+i.htmlEscape(this.la.boundvar.toString(!1))+"</span>"+i.htmlEscape(n)+')<span class="lf-beta lf-arg">'+i.htmlEscape(this.arg.toString(!1))+"</span>"+i.htmlEscape(this.right)}getTexRule(){return"\\beta"}}t.BetaRedex=a;class o extends s{constructor(e){super("eta"),this.content=e,this.app=e.expr,this.next=this.app.left,this.rule="eta"}toString(){return this.left+"["+this.content+"]"+this.right}toTexString(){return this.texLeft+"\\underline{\\strut "+this.content.toTexString(this.left+this.right==="")+"}"+this.texRight}toHTMLString(){return i.htmlEscape(this.left)+'<span class="lf-eta">'+i.htmlEscape(this.content.toString(this.left+this.right===""))+"</span>"+i.htmlEscape(this.right)}getTexRule(){return"\\eta"}}t.EtaRedex=o;class l extends s{constructor(e){super("macro"),this.content=e,this.next=e.expr,this.rule="macro"}toString(){return this.left+"[<"+this.content.name+">]"+this.right}toTexString(){return this.texLeft+"\\underline{\\strut "+this.content.toTexString(!1)+"}"+this.texRight}toHTMLString(){return i.htmlEscape(this.left)+'<span class="lf-macro">&lt;'+i.htmlEscape(this.content.name)+"&gt;</span>"+i.htmlEscape(this.right)}getTexRule(){return"{\\rm m}"}}t.MacroRedex=l;class u extends s{constructor(e,t,n){super("typed"),this.content=e,this.next=t,this.rule=n}toString(){return this.left+"["+this.content.toString(this.left+this.right==="")+"]"+this.right}toTexString(){return this.texLeft+"\\underline{\\strut "+this.content.toTexString(!1)+"}"+this.texRight}toHTMLString(){return i.htmlEscape(this.left)+'<span class="lf-typed">'+i.htmlEscape(this.content.toString(this.left+this.right===""))+"</span>"+i.htmlEscape(this.right)}getTexRule(){return"{\\rm ("+this.rule+")}"}}t.TypedRedex=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(2),i=n(0),s=n(1);class a{constructor(e){this.className=e}toString(){return this.getString(!0)}static parse(e){let t=e.split(""),n=null;for(;t.length>0;){let e=t.shift();switch(e){case"(":{let e=1,r="";for(;;){if(0===t.length)throw new i.LambdaParseError("Too many LPAREN '('");let n=t.shift();if("("===n&&e++,")"===n&&e--,0===e)break;r+=n}n=null===n?this.parse(r):new l(n,this.parse(r));break}case"\\":case"¥":case"λ":{let e=new o(this.parse(t.join("")));return null===n?e:new l(n,e)}case" ":break;default:{let r;if(null!==e.match(/^[0-9]$/)){let n=e;for(;t.length>0&&null!==t[0].match(/^[0-9]$/);)n+=t.shift();r=new u(parseInt(n))}else{if(null===e.match(/^[a-zA-Z]$/))throw new i.LambdaParseError("Unexpected token: '"+e+"'");{let n=e;for(;t.length>0&&null!==t[0].match(/^[a-zA-Z0-9]$/);)n+=t.shift();r=new h(n)}}n=null===n?r:new l(n,r)}}}if(null===n)throw new i.LambdaParseError("No contents in Expression");return n}toLambda(){return this.getLambda(h.toVariables(this.getFV()))}}t.deBrujinExpression=a;class o extends a{constructor(e){super("deBrujinLambda"),this.expr=e}getString(e){return r.putParens("\\ "+this.expr.getString(!0),e)}getLambda(e){let t=s.Variable.getNew(e);e.unshift(t);let n=this.expr.getLambda(e);return e.shift(),new s.LambdaAbstraction(t,n)}getFV(){return this.expr.getFV()}}t.deBrujinLambda=o;class l extends a{constructor(e,t){super("deBrujinApplication"),this.left=e,this.right=t}getString(e){return r.putParens(this.left.getString(this.left instanceof l)+" "+this.right.getString(!1),e)}getLambda(e){return new s.Application(this.left.getLambda(e),this.right.getLambda(e))}getFV(){return this.left.getFV().concat(this.right.getFV())}}t.deBrujinApplication=l;class u extends a{constructor(e){super("deBrujinIndex"),this.index=e}getString(e){return this.index.toString()}getLambda(e){if(this.index<e.length)return e[this.index];throw new i.TranslateError("de Brujin Index must be less than # of ancestor lambdas.")}getFV(){return[]}}t.deBrujinIndex=u;class h extends a{constructor(e){super("deBrujinFreeVar"),this.name=e}getString(e){return this.name}getLambda(e){return 1===this.name.length?this.toVariable():s.Macro.get(this.name,!1)}toVariable(){return new s.Variable(this.name)}static toVariables(e){let t=[];for(let n of e)t.push(n.toVariable());return t}getFV(){return[this]}}t.deBrujinFreeVar=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(3);let i=cytoscape({container:document.getElementById("graph"),boxSelectionEnabled:!1,autounselectify:!0,style:[{selector:"node",style:{label:"data(label)","background-color":"#11479e"}},{selector:"edge",style:{"target-arrow-shape":"triangle","curve-style":"bezier","target-arrow-color":"#9dbaea",width:3,"line-color":"#9dbaea"}},{selector:".goal",style:{"background-color":"#b3424a"}},{selector:".root",style:{"background-color":"#407f5d"}},{selector:".goal.root",style:{"background-color":"#d17200"}}]});MicroModal.init({disableScroll:!1,awaitCloseAnimation:!0});let s=void 0,a=!0,o=!1,l=!1,u=void 0,h=document.getElementById("input"),d=document.getElementById("output"),c=document.getElementById("untyped"),p=document.getElementById("typed"),f=document.getElementById("etaEnable"),g=document.getElementById("etaDisable"),m=document.getElementById("multiEdgeEnable"),x=document.getElementById("multiEdgeDisable"),b=document.getElementById("fileInput"),w=new FileReader,y=document.getElementById("clearMacroBtn"),T=document.getElementById("translate"),v=document.getElementById("tabA"),S=document.getElementById("outputBtns"),E=document.getElementById("stepInput"),L=document.getElementById("startGraph"),R=document.getElementById("stopGraph"),q=document.getElementById("imgGraph"),M=document.getElementById("maxDepth"),N=document.getElementById("tabAbtn"),F=document.getElementById("tabBbtn"),I=document.getElementById("tabC1btn"),B=document.getElementById("tabC2btn"),k=document.getElementById("tabDbtn"),V=document.getElementById("lmnInput"),A=document.getElementById("lmnSubmit"),C=document.getElementById("lmnOutput"),P=document.getElementById("deBrujinInput"),j=document.getElementById("deBrujinSubmit"),U=document.getElementById("deBrujinOutput"),$=document.getElementById("graphInput"),z=document.getElementById("graphSubmit"),D=document.getElementById("graphOutput");b.addEventListener("change",function(e){let t=e.target.files[0];if("text/plain"!==t.type)return alert("プレーンテキストを選択してください"),void(b.value="");w.readAsText(t)}),w.addEventListener("load",function(){let e=r.LambdaFriends.fileInput(w.result,a);se();let t=document.getElementById("fileInputLog");if(t.textContent=null,e.defs.length>0){let n=document.createElement("div"),r=document.createElement("p");r.innerText="Finally, "+e.defs.length+" macros are successfully added.";let i=document.createElement("ul");i.className="code";for(let t of e.defs){let e=document.createElement("li"),n=[].concat(t.names),r="<"+n.shift()+">";for(;n.length>0;){r+=" = <"+n.shift()+">"}e.innerText=r+" is defined as "+t.expr+" : "+t.type,i.appendChild(e)}n.appendChild(r),n.appendChild(i),t.appendChild(n)}if(e.errs.length>0){let n=document.createElement("div"),r=document.createElement("p");r.innerText="Unfortunately, "+e.errs.length+" macros are rejected due to some errors.";let i=document.createElement("ul");i.className="code";for(let t of e.errs){let e=document.createElement("li");e.innerText=t,i.appendChild(e)}n.appendChild(r),n.appendChild(i),t.appendChild(n)}MicroModal.show("modal-1",{debugMode:!0,disableScroll:!0,awaitCloseAnimation:!0})}),c.onclick=function(){c.className="btn btn-primary",p.className="btn btn-default",a=!1,f.disabled=!1,g.disabled=!1,m.disabled=!1,x.disabled=!1,se()},p.onclick=function(){p.className="btn btn-primary",c.className="btn btn-default",a=!0,f.disabled=!0,g.disabled=!0,m.disabled=!0,x.disabled=!0,se()},f.onclick=function(){f.className="btn btn-primary",g.className="btn btn-default",o=!0},g.onclick=function(){g.className="btn btn-primary",f.className="btn btn-default",o=!1},m.onclick=function(){m.className="btn btn-primary",x.className="btn btn-default",l=!0},x.onclick=function(){x.className="btn btn-primary",m.className="btn btn-default",l=!1},y.onclick=function(){r.LambdaFriends.clearMacro(a),se()},E.addEventListener("change",function(){let e=parseInt(E.value);s=isNaN(e)?void 0:e});let O=[],_=0,K=[""],H=function(){let e=h.value;if(""!==e||void 0===u){O.unshift(e),_=0,(K=[].concat(O)).unshift(""),e=(e=e.split("#")[0]).trim();try{let t=r.LambdaFriends.parseMacroDef(e,a);if(null===t)u=new r.LambdaFriends(e,a,o,l),X=0,i.remove("*"),i.add(ce(u.root)),pe(),re(u.toString()),a&&he(),de();else{let e=[].concat(t.names),n="<"+e.shift()+">";for(;e.length>0;){n+=" = <"+e.shift()+">"}re(n+=" is defined as "+t.expr+" : "+t.type),S.textContent=null}oe()}catch(e){re(e.toString()),console.log(e),S.textContent=null}se(),h.value=""}else W?Q():he()};document.getElementById("submit").onclick=H,document.getElementById("input").onkeydown=function(e){13===e.keyCode?(H(),e.preventDefault()):38===e.keyCode?(_<K.length-1&&(K[_]=h.value,_++,h.value=K[_]),e.preventDefault()):40===e.keyCode&&(_>0&&(K[_]=h.value,_--,h.value=K[_]),e.preventDefault())};let G,Z=!1,X=0,J=!1;function Q(){if(J)return;if(pe(),void 0===u)return;Z=!1,J=!0,X+=G||10;let e=()=>setTimeout(()=>{if(Z)return pe(),void(J=!1);let t=u.deepen(X);if(null===t)return pe(),void(J=!1);let n=[];for(let e of t.nodes)n.push(ce(e));for(let e of t.edges)n.push({group:"edges",data:{source:e.from.id.toString(),target:e.to.id.toString()}});pe(),i.add(n),e(),pe()},1);e()}L.onclick=Q,R.onclick=function(){Z=!0},q.onclick=function(){let e=document.createElement("a");e.download=(u?u.original.toString(!0):"lambda-friends")+".png",console.log(e.download),e.href=i.png({full:!0}),document.body.appendChild(e),e.click(),document.body.removeChild(e)},M.addEventListener("change",function(){let e=parseInt(M.value);G=isNaN(e)?void 0:e});let W=!1;function Y(){let e=V.value;try{let t=r.LambdaFriends.lmntal2LF(e);C.innerText="Found: "+t.expr.toString(!0)}catch(e){C.innerText=e.toString()}}function ee(){let e=P.value;try{let t=r.LambdaFriends.deBrujin2LF(e);U.innerText="Found: "+t.expr.toString(!0)}catch(e){U.innerText=e.toString()}}function te(){let e=$.value;try{let t=r.LambdaFriends.graph2LF(e,l);D.innerText=null===t?"Not Found":"Found: "+t.expr.toString(!0)}catch(e){D.innerText=e.toString()}}N.addEventListener("click",()=>{W=!1}),F.addEventListener("click",()=>{W=!1}),I.addEventListener("click",()=>{W=!1}),B.addEventListener("click",()=>{W=!1}),k.addEventListener("click",()=>{setTimeout(pe,10),W=!0}),V.onkeydown=function(e){13===e.keyCode&&(Y(),e.preventDefault())},A.onclick=Y,P.onkeydown=function(e){13===e.keyCode&&(ee(),e.preventDefault())},j.onclick=ee,$.onkeydown=function(e){13===e.keyCode&&(te(),e.preventDefault())},z.onclick=te;let ne="";function re(e){ne=e+"\n",d.innerHTML=ae(ne)}function ie(e){ne+=e+"\n",d.innerHTML=ae(ne)}function se(){let e=document.getElementById("macroList");e.innerHTML="";let t=r.LambdaFriends.getMacroListAsObject(a);for(let n in t){let r=t[n];e.innerHTML+="<tr><th>"+ae(r.name)+"</th><td>"+ae(r.expr.toString(!0))+"</td><td>"+ae(r.type.toString())+"</td></tr>"}}function ae(e){return e.replace(/[&'`"<> \n]/g,function(e){return{"&":"&amp;","'":"&#x27;","`":"&#x60;",'"':"&quot;","<":"&lt;",">":"&gt;"," ":"&nbsp;","\n":"<br>"}[e]})}function oe(){if(T.textContent=null,void 0===u)return;let e=document.createElement("h4");e.innerText=u.getOriginalString(),T.appendChild(e),T.appendChild(le("これまでの簡約過程",u.getProcessTex())),a?T.appendChild(le("型付けの証明木",u.getProofTree())):(T.appendChild(le("LMNtalコード",u.toLMNtal())),T.appendChild(le("SKIコンビネータ",u.toSKI())),T.appendChild(le("de Brujin Index",u.toDeBrujin())))}function le(e,t){let n=document.createElement("p"),r=document.createElement("button"),i=document.createElement("span"),s=document.createElement("div"),a=document.createElement("p");s.classList.add("code"),n.appendChild(r),n.appendChild(i),s.appendChild(a),a.innerText=t,i.innerText=e,r.type="button",r.className="btn btn-default btn-sm",r.innerText="クリップボードにコピー",r.onclick=function(){let e=document.getSelection();e.selectAllChildren(s),document.execCommand("copy"),e.collapse(document.body,0)};let o=document.createElement("div");return o.appendChild(n),o.appendChild(s),o}let ue=!1;function he(){if(ue)return;ue=!0,S.textContent=null;let e=t=>setTimeout(()=>{if(0===t||!u.hasNext())return de(),v.scrollTop=d.offsetHeight-15,void(ue=!1);ie(u.reduction()),v.scrollTop=d.offsetHeight-15,oe(),e(t-1)},1);e(void 0===s?100:s)}function de(){if(!u.hasNext())return void(S.textContent=null);let e=document.createElement("button");if(e.type="button",e.className="btn btn-default btn-sm",e.innerText="最左簡約を続ける",e.onclick=he,S.textContent=null,S.appendChild(e),a)return;let t=document.createElement("span");t.innerText="または、以下から簡約基を選ぶ：",S.appendChild(t);let n=document.createElement("div");n.className="list-group",S.appendChild(n);let r=u.getRedexes();for(let e of r){let t=document.createElement("button");t.className="list-group-item code",t.innerHTML=e.toHTMLString(),t.onclick=function(){ie(u.reduction(e)),de(),v.scrollTop=d.offsetHeight-15,oe()},n.appendChild(t)}}function ce(e){return{group:"nodes",data:{id:""+e.id,label:""+e.toString()},classes:(e.isNormalForm?"goal ":"")+(e.isRoot?"root":"")}}function pe(){i.resize(),i.elements().makeLayout({name:"dagre",nodeSpacing:5,animate:!0,randomize:!1,maxSimulationTime:1500}).run()}c.onclick(null),g.onclick(null),x.onclick(null),se()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(3);class s{constructor(e,t,n){this.children=[],this.label=e,this.info=t,this.id=t.nextId++,this.isRoot=n,t.nodes.push(this)}toString(){return this.label}equalsShape(e){return this.info.nodes.length===e.info.nodes.length&&this.info.edges.length===e.info.edges.length&&this.info.allowMultipleEdges===e.info.allowMultipleEdges&&function e(t,n,r){if(t.children.length!==n.children.length)return!1;r.push({n1:t,n2:n});let i=[].concat(n.children);let s=!0;for(let n of t.children){let t=!1;for(let s=0;s<i.length;s++){let a=i[s],o=void 0;for(let e of r)if(e.n1.id===n.id||e.n2.id===a.id){o=e;break}if(void 0===o&&e(n,a,r)||void 0!==o&&o.n1.id===n.id&&o.n2.id===a.id){i.splice(s,1),t=!0;break}}if(!t){s=!1;break}}for(let e=0;e<r.length;e++)if(r[e].n1.id===t.id)return r.splice(e,1),s;throw new Error("Unexpected Error")}(this,e,[])}static parse(e){let t=e.split(";"),n=new a([],[],null,null,0,!1),i={};for(let e of t){let t=e.split("->"),r=o(t[0]);for(let e=1;e<t.length;e++){let i=o(t[e]);for(let e of r)for(let t of i)n.hasEdge({from:e,to:t})&&(n.allowMultipleEdges=!0),n.edges.push({from:e,to:t}),e.children.push(t);r=i}}if(void 0===i.root)throw new r.GraphParseError("there must be a 'root' node.");return i.root;function o(e){let t=e.split(","),a=[];for(let e of t){if(""===(e=e.trim()))continue;if(!/^[a-z][a-z0-9]*$/.test(e))throw new r.GraphParseError("the name '"+e+"' cannot be used as node name, must be [a-z][a-z0-9]*");let t=i[e];void 0===t&&(t=i[e]=new s(e,n,"root"===e)),a.push(t)}return a}}static search(e,t){let r,s="graph_closure.csv";try{let e=new XMLHttpRequest;e.open("GET",s,!1),e.send(null),r=e.responseText}catch(e){0;let t=n(9);try{t.statSync(s)}catch(e){return void console.error("File Not Found: "+s)}r=t.readFileSync(s,"utf8")}let a=r.split("\n");for(let n of a){let r=n.split(",");if(parseInt(r[2])===e.info.nodes.length&&parseInt(r[3])===e.info.edges.length){let n=new i.LambdaFriends(r[0],!1,!1,t);for(;null!==n.deepen(););if(n.root.equalsShape(e))return n}}return null}}t.GraphNode=s;class a{constructor(e,t,n,r,i,s){this.nodes=e,this.edges=t,this.typed=n,this.etaAllowed=r,this.nextId=i,this.allowMultipleEdges=s}hasEdge(e){for(let t of this.edges)if(t.from.id===e.from.id&&t.to.id===e.to.id)return!0;return!1}}class o extends s{constructor(e,t,n,r){if(super((e=e.extractMacros()).toString(!0),n,r),this.expr=e,this.parent=t,this.depth=null===t?0:t.depth+1,n.typed){let e=this.expr.getTypedRedex(!0);this.nextrs=e?[e]:[]}else this.nextrs=this.expr.getRedexes(n.etaAllowed,!0);this.isNormalForm=0===this.nextrs.length}static makeRoot(e,t,n,r){return new o(e,null,new a([],[],t,n,0,r),!0)}visit(){let e={nodes:[],edges:[]};for(let t of this.nextrs){let n=this.find(t.next);if(null===n){let n=new o(t.next,this,this.info,!1);this.children.push(n),e.nodes.push(n),!this.info.allowMultipleEdges&&this.info.hasEdge({from:this,to:n})||(e.edges.push({from:this,to:n}),this.info.edges.push({from:this,to:n}))}else this.children.push(n),!this.info.allowMultipleEdges&&this.info.hasEdge({from:this,to:n})||(e.edges.push({from:this,to:n}),this.info.edges.push({from:this,to:n}))}return e}find(e){for(let t of this.info.nodes)if(t.expr.equalsAlpha(e))return t;return null}}t.ReductionNode=o},function(e,t){e.exports=require("fs")}]);